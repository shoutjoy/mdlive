<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Markdown PDF Editor Pro V7</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Figtree:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>
<style>
:root{
  --bg:#0f0f13;--bg2:#16161d;--bg3:#1c1c26;--bg4:#22222f;--bg5:#2a2a3a;
  --bd:#2e2e42;--bda:#4a4a6a;
  --ac:#7c6af7;--acd:#4a3fc4;--acg:rgba(124,106,247,.15);--ac2:#f7a06a;
  --tx:#e8e8f0;--tx2:#9090b0;--tx3:#55556a;--txh:#fff;
  --er:#f76a6a;--ok:#6af7a0;--wn:#f7d06a;
  --fm:'JetBrains Mono',monospace;--fb:'Figtree',sans-serif;--fs:'Libre Baskerville',serif;
  --r:6px;--sh:0 4px 24px rgba(0,0,0,.4);--tr:.15s ease;--sw:240px;
}
[data-theme=light]{
  --bg:#f0f0f5;--bg2:#fff;--bg3:#f7f7fc;--bg4:#ededf5;--bg5:#e8e8f2;
  --bd:#d0d0e0;--bda:#a0a0c0;--ac:#5b4ce4;--acd:#3d31a8;--acg:rgba(91,76,228,.1);
  --tx:#1a1a2e;--tx2:#505070;--tx3:#9090a8;--txh:#0a0a18;
  --er:#d64242;--ok:#2a8a50;--wn:#c07010;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden;font-family:var(--fb);background:var(--bg);color:var(--tx);font-size:14px;line-height:1.5;-webkit-font-smoothing:antialiased}
/* layout */
#app{display:grid;grid-template-rows:36px 44px 1fr 26px;grid-template-columns:var(--sw) 1fr;height:100vh;grid-template-areas:"tb tb""bar bar""side main""stat stat"}
#app.ns{grid-template-columns:0 1fr}
#app.ns #sidebar{display:none}
/* titlebar */
#titlebar{grid-area:tb;display:flex;align-items:center;background:var(--bg2);border-bottom:1px solid var(--bd);height:36px;padding:0 10px;z-index:100;gap:5px}
#app-logo{display:flex;align-items:center;gap:7px;font-family:var(--fm);font-size:11px;font-weight:600;color:var(--ac);letter-spacing:.05em;flex-shrink:0}
.logo-icon{width:20px;height:20px;background:var(--ac);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;color:#fff;font-weight:700}
#doc-title{flex:1;text-align:center;background:none;border:none;color:var(--tx2);font-family:var(--fb);font-size:13px;outline:none;cursor:pointer;transition:color var(--tr)}
#doc-title:hover,#doc-title:focus{color:var(--tx);cursor:text}
#tba{display:flex;align-items:center;gap:4px;flex-shrink:0}
/* toolbar */
#toolbar{grid-area:bar;display:flex;align-items:center;background:var(--bg2);border-bottom:1px solid var(--bd);padding:0 6px;overflow-x:auto;scrollbar-width:none;user-select:none}
#toolbar::-webkit-scrollbar{display:none}
.tg{display:flex;align-items:center;gap:1px;flex-shrink:0}
.ts{width:1px;height:18px;background:var(--bd);margin:0 4px;flex-shrink:0}
.tb{display:flex;align-items:center;justify-content:center;min-width:26px;height:26px;padding:0 5px;border:none;background:transparent;color:var(--tx2);border-radius:var(--r);cursor:pointer;font-size:11px;font-family:var(--fb);font-weight:500;transition:all var(--tr);white-space:nowrap;position:relative}
.tb:hover{background:var(--bg5);color:var(--tx)}.tb.active{background:var(--acg);color:var(--ac)}
.tbsel{background:var(--bg3);border:1px solid var(--bd);border-radius:var(--r);color:var(--tx2);font-size:11px;padding:2px 4px;outline:none;cursor:pointer;font-family:var(--fb);height:26px}
/* sidebar */
#sidebar{grid-area:side;background:var(--bg2);border-right:1px solid var(--bd);display:flex;flex-direction:column;overflow:hidden}
#sb-hdr{padding:8px 12px;font-size:10px;font-weight:600;letter-spacing:.1em;color:var(--tx3);text-transform:uppercase;border-bottom:1px solid var(--bd);display:flex;align-items:center;justify-content:space-between}
#toc-list{flex:1;overflow-y:auto;padding:4px 0;scrollbar-width:thin;scrollbar-color:var(--bd) transparent}
.toc-item{display:flex;align-items:center;gap:6px;padding:3px 12px;cursor:pointer;color:var(--tx2);font-size:12px;line-height:1.4;transition:all var(--tr);border-left:2px solid transparent}
.toc-item:hover{color:var(--tx);background:var(--bg3)}.toc-item.active{color:var(--ac);border-left-color:var(--ac);background:var(--acg)}
.toc-item[data-level="2"]{padding-left:22px}.toc-item[data-level="3"]{padding-left:34px;font-size:11px}
.toc-num{font-family:var(--fm);font-size:10px;color:var(--tx3);flex-shrink:0}
#sb-stats{padding:6px 12px;border-top:1px solid var(--bd);font-size:11px;color:var(--tx3);display:flex;flex-direction:column;gap:2px}
/* main */
#main{grid-area:main;display:flex;flex-direction:column;overflow:hidden}
#find-bar{display:none;align-items:center;gap:6px;padding:4px 10px;background:var(--bg2);border-bottom:1px solid var(--bd);flex-shrink:0}
#find-bar.vis{display:flex}
#find-bar input{background:var(--bg3);border:1px solid var(--bd);border-radius:4px;color:var(--tx);padding:3px 7px;font-size:12px;font-family:var(--fb);outline:none;width:140px}
#find-bar input:focus{border-color:var(--ac)}
#editor-wrap{flex:1;display:flex;overflow:hidden;position:relative}
/* editor pane */
#editor-pane{flex:1;display:flex;flex-direction:column;overflow:hidden;border-right:1px solid var(--bd)}
#editor-pane.hidden{display:none}
#ed-hdr{display:flex;align-items:center;padding:3px 8px;background:var(--bg2);border-bottom:1px solid var(--bd);gap:6px;height:30px;flex-shrink:0}
.pane-lbl{font-size:10px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--tx3)}
.pane-lbl span{width:6px;height:6px;border-radius:50%;background:var(--ac);display:inline-block;margin-right:5px}
#ed-container{flex:1;position:relative;overflow:hidden}
#line-numbers{position:absolute;left:0;top:0;bottom:0;width:42px;background:var(--bg2);border-right:1px solid var(--bd);overflow:hidden;pointer-events:none;display:none;z-index:1}
#line-numbers.vis{display:block}
.lnc{padding-top:12px;display:flex;flex-direction:column;align-items:flex-end;padding-right:8px}
.ln{font-family:var(--fm);font-size:11px;color:var(--tx3);line-height:21px;height:21px}
#editor{width:100%;height:100%;background:var(--bg3);color:var(--tx);border:none;outline:none;resize:none;font-family:var(--fm);font-size:13.5px;line-height:21px;padding:12px 14px;tab-size:2;word-wrap:break-word;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:var(--bd) transparent}
#editor.wln{padding-left:58px}
#editor::placeholder{color:var(--tx3)}
/* preview pane */
#preview-pane{flex:1;display:flex;flex-direction:column;overflow:hidden}
#preview-pane.hidden{display:none}
#pv-hdr{display:flex;align-items:center;padding:3px 8px;background:var(--bg2);border-bottom:1px solid var(--bd);gap:6px;height:30px;flex-shrink:0}
#preview-container{flex:1;overflow-y:auto;overflow-x:hidden;background:#6a6e7e;display:flex;flex-direction:column;align-items:center;padding:16px 0 36px;scrollbar-width:thin;scrollbar-color:#444 transparent}
/* A4 page cards */
.preview-page{width:210mm;min-height:297mm;background:white;color:#1a1a2e;padding:22mm 18mm;box-shadow:0 6px 40px rgba(0,0,0,.5);font-family:var(--fs);font-size:11pt;line-height:1.8;word-break:break-word;position:relative;flex-shrink:0;margin-bottom:16px}
.preview-page::after{content:"â€” " attr(data-page) " â€”";position:absolute;bottom:10mm;left:50%;transform:translateX(-50%);font-family:sans-serif;font-size:9pt;color:#bbb;white-space:nowrap}
.preview-page h1{font-size:21pt;font-weight:700;margin:0 0 14px;border-bottom:2.5px solid #1a1a2e;padding-bottom:8px}
.preview-page h2{font-size:15pt;font-weight:700;margin:20px 0 10px}
.preview-page h3{font-size:12pt;font-weight:700;margin:16px 0 7px;color:#2a2a3e}
.preview-page h4{font-size:11pt;font-weight:700;margin:14px 0 5px}
.preview-page p{margin:0 0 11px}
.preview-page ul,.preview-page ol{margin:0 0 11px;padding-left:22px}
.preview-page li{margin-bottom:3px}
.preview-page blockquote{border-left:3px solid #5b4ce4;margin:14px 0;padding:7px 14px;background:#f5f5ff;color:#3a3a5e;font-style:italic}
.preview-page code{font-family:'JetBrains Mono',monospace;font-size:9pt;background:#f0f0f8;padding:1px 4px;border-radius:3px;color:#5b4ce4}
.preview-page pre{background:#1a1a2e;color:#e8e8f0;padding:14px;border-radius:6px;overflow-x:auto;margin:11px 0;font-size:9pt}
.preview-page pre code{background:none;color:inherit;padding:0}
.preview-page table{width:100%;border-collapse:collapse;margin:11px 0;font-size:10pt}
.preview-page th{background:#1a1a2e;color:#fff;padding:7px 11px;text-align:left;font-weight:600}
.preview-page td{padding:6px 11px;border:1px solid #d0d0e0}
.preview-page tr:nth-child(even) td{background:#f7f7fc}
.preview-page img{max-width:100%}
.preview-page a{color:#5b4ce4;text-decoration:underline;text-underline-offset:2px}
.preview-page a[href^="http"]::after{content:" â†—";font-size:8pt;opacity:.5}
.preview-page .ref-block{border-top:1px solid #d0d0e0;margin-top:28px;padding-top:10px;font-size:9pt;color:#4a4a6a}
.preview-page .tbl-caption{font-size:10pt;font-weight:600;color:#1a1a2e;margin-bottom:5px;display:block}
.preview-page .fig-caption{font-size:10pt;color:#4a4a6a;margin-top:5px;font-style:italic;display:block;text-align:center}
/* RESEARCH MODE: paragraph line numbers */
.preview-page.rm{counter-reset:pln}
.preview-page.rm>p{counter-increment:pln;padding-left:36px;position:relative}
.preview-page.rm>p::before{content:counter(pln);position:absolute;left:0;top:0;font-family:'JetBrains Mono',monospace;font-size:8.5pt;color:#b0b0c8;min-width:28px;text-align:right;user-select:none;border-right:1px solid #ddd;margin-right:8px;padding-right:6px}
/* statusbar */
#statusbar{grid-area:stat;display:flex;align-items:center;padding:0 12px;background:var(--acd);color:rgba(255,255,255,.85);font-size:11px;gap:12px;font-family:var(--fm);overflow:hidden}
.si{white-space:nowrap;flex-shrink:0}.ss{color:rgba(255,255,255,.3);flex-shrink:0}.ssp{flex:1}
#autosave-indicator{display:flex;align-items:center;gap:4px}
.save-dot{width:6px;height:6px;border-radius:50%;background:var(--ok)}
.save-dot.saving{animation:pulse .8s ease infinite;background:var(--wn)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
#error-count{color:var(--er);cursor:pointer}
/* buttons */
.btn{display:inline-flex;align-items:center;gap:4px;padding:5px 11px;border:none;border-radius:var(--r);cursor:pointer;font-family:var(--fb);font-size:12px;font-weight:500;transition:all var(--tr)}
.btn-p{background:var(--ac);color:#fff}.btn-p:hover{background:var(--acd)}
.btn-g{background:transparent;border:1px solid var(--bd);color:var(--tx2)}.btn-g:hover{border-color:var(--bda);color:var(--tx);background:var(--bg5)}
.btn-sm{padding:3px 8px;font-size:11px}
.btn-ic{background:transparent;border:none;color:var(--tx2);cursor:pointer;padding:4px;border-radius:var(--r);transition:all var(--tr);display:flex;align-items:center;justify-content:center;font-size:13px}.btn-ic:hover{color:var(--tx);background:var(--bg5)}
.btn-tog{background:var(--bg3);border:1px solid var(--bd);color:var(--tx2)}.btn-tog.active{background:var(--acg);border-color:var(--ac);color:var(--ac)}
/* tooltip */
#tooltip{position:fixed;z-index:9999;background:#1a1a2e;color:#e8e8f0;padding:5px 9px;border-radius:5px;font-family:var(--fb);font-size:11px;pointer-events:none;opacity:0;transition:opacity .15s;max-width:260px;box-shadow:0 4px 16px rgba(0,0,0,.4);border:1px solid #2e2e42;line-height:1.4}
#tooltip.vis{opacity:1}
.tt-key{display:inline-block;background:#2e2e42;border-radius:3px;padding:0 4px;font-family:var(--fm);font-size:10px;color:#a0a0c0;margin-left:4px}
/* overlays & modals */
.ov{position:fixed;inset:0;z-index:8000;background:rgba(0,0,0,.55);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center}
.ov.vis{display:flex}
.modal{background:var(--bg2);border:1px solid var(--bd);border-radius:10px;padding:22px;min-width:340px;max-width:560px;width:90vw;box-shadow:var(--sh);max-height:90vh;overflow-y:auto}
.modal.lg{max-width:780px}.modal.xl{max-width:940px}
.modal h3{font-size:15px;font-weight:600;margin-bottom:14px;color:var(--txh)}
.mb{margin-bottom:16px}.mf{display:flex;gap:8px;justify-content:flex-end;margin-top:14px}
.fg{margin-bottom:10px}
.fl{display:block;font-size:11px;color:var(--tx2);margin-bottom:3px;font-weight:500}
.fi{width:100%;background:var(--bg3);border:1px solid var(--bd);border-radius:var(--r);color:var(--tx);padding:7px 10px;font-family:var(--fb);font-size:13px;outline:none;transition:border-color var(--tr)}
.fi:focus{border-color:var(--ac)}
select.fi option{background:var(--bg2)}
textarea.fi{resize:vertical;min-height:70px;font-family:var(--fm);font-size:12px;line-height:1.6}
/* tabs */
.tab-row{display:flex;border-bottom:1px solid var(--bd);margin-bottom:14px}
.tab{padding:6px 13px;font-size:12px;font-weight:500;color:var(--tx3);cursor:pointer;border-bottom:2px solid transparent;transition:all var(--tr);white-space:nowrap}
.tab.active{color:var(--ac);border-bottom-color:var(--ac)}
.tp{display:none}.tp.active{display:block}
/* cite */
#cite-list-area{min-height:60px;max-height:210px;overflow-y:auto;border:1px solid var(--bd);border-radius:var(--r);background:var(--bg3);margin-bottom:10px}
.cite-entry{display:flex;align-items:flex-start;gap:8px;padding:7px 11px;border-bottom:1px solid var(--bd);cursor:pointer;transition:background var(--tr)}
.cite-entry:last-child{border-bottom:none}
.cite-entry:hover{background:var(--bg5)}
.cite-entry input[type=checkbox]{margin-top:3px;accent-color:var(--ac);flex-shrink:0}
.cite-body{flex:1;min-width:0}
.cite-key{font-family:var(--fm);font-size:11px;color:var(--ac);font-weight:600;margin-bottom:2px}
.cite-full{font-size:11px;color:var(--tx2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cite-empty{padding:18px;text-align:center;color:var(--tx3);font-size:12px}
#lib-list{min-height:50px;max-height:280px;overflow-y:auto;border:1px solid var(--bd);border-radius:var(--r);background:var(--bg3)}
.lib-item{display:flex;align-items:center;padding:5px 10px;border-bottom:1px solid var(--bd);font-size:11px;gap:6px}
.lib-item:last-child{border-bottom:none}
.lib-key{font-family:var(--fm);font-size:10px;color:var(--ac);font-weight:600;flex-shrink:0;min-width:90px}
/* error panel */
#error-panel{position:absolute;bottom:0;left:0;right:0;background:var(--bg2);border-top:1px solid var(--bd);max-height:100px;overflow-y:auto;z-index:50;display:none}
#error-panel.vis{display:block}
#ep-hdr{display:flex;align-items:center;justify-content:space-between;padding:4px 12px;font-size:11px;font-weight:600;color:var(--er);border-bottom:1px solid var(--bd)}
.error-item{padding:3px 12px;font-size:11px;font-family:var(--fm);color:var(--tx2);border-bottom:1px solid var(--bd)}
/* hotkey overlay */
#hk-overlay{position:fixed;inset:0;z-index:10000;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center}
#hk-overlay.vis{display:flex}
#hk-panel{background:var(--bg2);border:1px solid var(--bd);border-radius:12px;padding:22px;max-width:700px;width:92vw;max-height:82vh;overflow-y:auto;box-shadow:0 24px 80px rgba(0,0,0,.5)}
#hk-panel h2{font-size:15px;font-weight:600;color:var(--txh);margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}
.hk-s{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.1em;color:var(--ac);margin:12px 0 6px}
.hk-grid{display:grid;grid-template-columns:1fr 1fr;gap:3px}
.hk-item{display:flex;align-items:center;justify-content:space-between;padding:4px 8px;border-radius:4px;background:var(--bg3)}
.hk-desc{font-size:11px;color:var(--tx2)}.hk-keys{display:flex;gap:2px;flex-shrink:0}
kbd{background:var(--bg5);border:1px solid var(--bd);border-radius:3px;padding:1px 5px;font-family:var(--fm);font-size:9px;color:var(--tx)}
/* color swatches */
.csw-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:4px}
.csw{width:22px;height:22px;border-radius:3px;cursor:pointer;border:2px solid transparent;transition:border-color .1s}
.csw:hover,.csw.sel{border-color:white}
/* template grid */
.tmpl-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.tmpl-card{border:1px solid var(--bd);border-radius:8px;padding:12px;cursor:pointer;transition:all var(--tr);background:var(--bg3)}
.tmpl-card:hover{border-color:var(--ac);background:var(--acg)}
.tmpl-card h4{font-size:13px;font-weight:600;color:var(--txh);margin-bottom:4px}
.tmpl-card p{font-size:11px;color:var(--tx2);line-height:1.4}
/* rm badge */
#rm-badge{background:var(--acd);color:rgba(255,255,255,.9);font-size:10px;font-weight:600;padding:2px 7px;border-radius:3px;display:none}
#rm-badge.vis{display:inline-block}
#vm-sel{background:var(--bg3);border:1px solid var(--bd);border-radius:var(--r);color:var(--tx2);font-size:11px;padding:2px 6px;outline:none;cursor:pointer;font-family:var(--fb)}
#pw-btn{position:relative}
#pw-btn::after{content:'';position:absolute;top:3px;right:3px;width:5px;height:5px;border-radius:50%;background:var(--ok);display:none}
#pw-btn.open::after{display:block}
.spacer{flex:1}
/* caption opts */
.cap-opt{padding:4px 10px;border:1px solid var(--bd);border-radius:var(--r);font-size:12px;cursor:pointer;background:var(--bg3);color:var(--tx2);transition:all var(--tr)}
.cap-opt.sel{border-color:var(--ac);background:var(--acg);color:var(--ac)}
/* footnote highlight in editor via preview */
.preview-page .footnote-highlight{background:#f0f0f0;color:#1a1a2e;border-radius:2px;padding:0 2px}
.preview-page .footnote-def{background:#f5f5f5;color:#1a1a2e;border-left:3px solid #bbb;padding:4px 10px;margin:4px 0;font-size:9.5pt}
.preview-page .footnotes-section{border-top:1px solid #d0d0e0;margin-top:24px;padding-top:10px;font-size:9.5pt;color:#444}
/* editor footnote syntax highlight */
#editor{caret-color:var(--ac)}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--bd);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--bda)}
@media print{
  #app{display:block;height:auto}
  #titlebar,#toolbar,#sidebar,#statusbar,#editor-pane{display:none!important}
  #main{display:block}#preview-pane{display:block!important}
  #preview-container{background:white;padding:0;display:block}
  .preview-page{box-shadow:none;margin:0;page-break-after:always;width:100%;min-height:0}
  .preview-page:last-child{page-break-after:auto}
  .preview-page::after{display:none}
}
</style>
</head>
<body>
<div id="app">

<!-- TITLEBAR -->
<header id="titlebar">
  <div id="app-logo"><div class="logo-icon">M</div>MD PRO V7</div>
  <input id="doc-title" type="text" value="Untitled Document" spellcheck="false">
  <div id="tba">
    <span id="rm-badge">RESEARCH</span>
    <button class="btn btn-g btn-sm" onclick="App.showTmpl()" data-tooltip="ë…¼ë¬¸ ì–‘ì‹ ì„ íƒ">ğŸ“‹ ì–‘ì‹</button>
    <button class="btn btn-g btn-sm" onclick="App.toggleRM()" data-tooltip="Research Mode (ë‹¨ë½ ì¤„ë²ˆí˜¸)" data-key="Ctrl+Shift+R">ğŸ”¬ Research</button>
    <button class="btn btn-g btn-sm" onclick="App.showCite()" data-tooltip="ì°¸ê³ ë¬¸í—Œ ê´€ë¦¬ & ì¸ìš©" data-key="Ctrl+Shift+C">ğŸ“š References</button>
    <button class="btn btn-g btn-sm" onclick="App.showSaveDlg()" data-tooltip="ì €ì¥ í˜•ì‹ ì„ íƒ" data-key="Ctrl+S">ğŸ’¾ ì €ì¥</button>
    <button class="btn btn-p btn-sm" onclick="App.printDoc()" data-tooltip="ì¸ì‡„ / PDF ì €ì¥">ğŸ–¨ï¸ ì¸ì‡„</button>
  </div>
</header>

<!-- TOOLBAR -->
<div id="toolbar">
  <div class="tg"><button class="tb" onclick="App.toggleSidebar()" data-tooltip="ì‚¬ì´ë“œë°”">â˜°</button></div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" onclick="ED.h(1)" data-tooltip="ì œëª© H1" data-key="Ctrl+Alt+1"><b>H1</b></button>
    <button class="tb" onclick="ED.h(2)" data-tooltip="ì œëª© H2" data-key="Ctrl+Alt+2"><b>H2</b></button>
    <button class="tb" onclick="ED.h(3)" data-tooltip="ì œëª© H3" data-key="Ctrl+Alt+3"><b>H3</b></button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" id="bold-btn" onclick="ED.bold()" data-tooltip="Smart Bold" data-key="Ctrl+B"><b>B</b></button>
    <button class="tb" id="italic-btn" onclick="ED.italic()" data-tooltip="ê¸°ìš¸ì„ê¼´" data-key="Ctrl+I"><i>I</i></button>
    <button class="tb" onclick="ED.strike()" data-tooltip="ì·¨ì†Œì„ ">SÌ¶</button>
    <button class="tb" onclick="ED.inlineCode()" data-tooltip="ì¸ë¼ì¸ ì½”ë“œ"><code style="font-size:10px">`c`</code></button>
  </div>
  <div class="ts"></div>
  <!-- font size -->
  <div class="tg">
    <select class="tbsel" id="fsize-sel" onchange="ED.fontSize(this.value)" data-tooltip="ê¸€ì í¬ê¸°">
      <option value="">í¬ê¸°</option>
      <option>8pt</option><option>9pt</option><option>10pt</option><option>11pt</option>
      <option>12pt</option><option>14pt</option><option>16pt</option><option>18pt</option>
      <option>20pt</option><option>24pt</option><option>28pt</option>
    </select>
  </div>
  <!-- font color + highlight -->
  <div class="tg">
    <button class="tb" id="fc-btn" onclick="App.openColorPicker('text')" data-tooltip="ê¸€ì ìƒ‰ìƒ" style="flex-direction:column;gap:1px">
      <span style="font-size:11px;font-weight:700">A</span>
      <span id="fc-bar" style="width:14px;height:2px;border-radius:1px;background:#e8e8f0"></span>
    </button>
    <button class="tb" id="hl-btn" onclick="App.openColorPicker('bg')" data-tooltip="í˜•ê´‘íœ í•˜ì´ë¼ì´íŠ¸" style="flex-direction:column;gap:1px">
      <span style="font-size:11px">ğŸ–Š</span>
      <span id="hl-bar" style="width:14px;height:2px;border-radius:1px;background:transparent;border:1px solid var(--bd)"></span>
    </button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" onclick="ED.align('left')" data-tooltip="ì™¼ìª½ ì •ë ¬" data-key="Shift+Alt+L">â‡¤</button>
    <button class="tb" onclick="ED.align('center')" data-tooltip="ê°€ìš´ë° ì •ë ¬" data-key="Shift+Alt+C">â‡”</button>
    <button class="tb" onclick="ED.align('right')" data-tooltip="ì˜¤ë¥¸ìª½ ì •ë ¬" data-key="Shift+Alt+R">â‡¥</button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" onclick="ED.list('ul')" data-tooltip="ëª©ë¡">â€¢ List</button>
    <button class="tb" onclick="ED.list('ol')" data-tooltip="ë²ˆí˜¸ ëª©ë¡">1. List</button>
    <button class="tb" onclick="ED.bquote()" data-tooltip="ì¸ìš©êµ¬" data-key="Ctrl+.">â</button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" onclick="ED.table()" data-tooltip="í‘œ ì‚½ì…" data-key="Alt+8">âŠ í‘œ</button>
    <button class="tb" onclick="ED.tableRow()" data-tooltip="í–‰ ì¶”ê°€" data-key="Alt+9">+í–‰</button>
    <button class="tb" onclick="ED.tableCol()" data-tooltip="ì—´ ì¶”ê°€" data-key="Alt+0">+ì—´</button>
    <button class="tb" onclick="App.showCaption('table')" data-tooltip="í‘œ ìº¡ì…˜">ã€ˆí‘œã€‰</button>
    <button class="tb" onclick="App.showCaption('fig')" data-tooltip="ê·¸ë¦¼ ìº¡ì…˜">[ê·¸ë¦¼]</button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <!-- hotkey = direct insert with last lang; toolbar button = show modal -->
    <button class="tb" onclick="App.showCode()" data-tooltip="ì½”ë“œ ë¸”ë¡ ì–¸ì–´ ì„ íƒ (ë©”ë‰´) / Alt+C = ë§ˆì§€ë§‰ ì–¸ì–´ ì§ì ‘ ì‚½ì…">âŒ¨ Code</button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" onclick="ED.pageBreak()" data-tooltip="í˜ì´ì§€ ë‚˜ëˆ„ê¸°" data-key="Ctrl+Enter">â‹¯ PB</button>
    <button class="tb" onclick="ED.lineBreak()" data-tooltip="ì¤„ë°”ê¿ˆ &lt;br&gt;" data-key="Ctrl+Shift+Enter">â†©</button>
    <button class="tb" onclick="App.showImg()" data-tooltip="ì´ë¯¸ì§€">ğŸ–¼</button>
    <button class="tb" onclick="App.showLink()" data-tooltip="ë§í¬ (ìƒˆ íƒ­)">ğŸ”—</button>
    <button class="tb" onclick="ED.footnote()" data-tooltip="ê°ì£¼">â€ </button>
    <button class="tb" onclick="ED.math()" data-tooltip="ìˆ˜ì‹(LaTeX)">âˆ‘</button>
    <button class="tb" onclick="App.showCite()" data-tooltip="ì¸ìš© ì‚½ì…" data-key="Ctrl+Shift+C">ğŸ“–</button>
  </div>
  <div class="ts"></div>
  <div class="tg"><button class="tb" onclick="App.toggleFind()" data-tooltip="ì°¾ê¸°/ë°”ê¾¸ê¸°" data-key="Ctrl+F">ğŸ”</button></div>
  <div class="spacer"></div>
  <div class="tg"><select id="vm-sel" onchange="App.setView(this.value)"><option value="split">Split</option><option value="editor">Editor</option><option value="preview">Preview</option></select></div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" id="pw-btn" onclick="PW.open()" data-tooltip="ìƒˆì°½ ë¯¸ë¦¬ë³´ê¸°" data-key="Ctrl+Shift+P">ğŸ—— PV</button>
    <button class="tb" onclick="PW.forceRefresh()" data-tooltip="ìƒˆì°½ ê°•ì œ ìƒˆë¡œê³ ì¹¨">â†»</button>
  </div>
  <div class="ts"></div>
  <div class="tg">
    <button class="tb" onclick="App.toggleTheme()" data-tooltip="í…Œë§ˆ ì „í™˜">â—‘</button>
    <button class="tb" id="ln-btn" onclick="LN.toggle()" data-tooltip="ì¤„ ë²ˆí˜¸">ln</button>
    <button class="tb" onclick="App.showHK()" data-tooltip="ë‹¨ì¶•í‚¤ ëª©ë¡" data-key="Shift+?">?</button>
  </div>
</div>

<!-- SIDEBAR -->
<nav id="sidebar">
  <div id="sb-hdr"><span>ëª©ì°¨ (TOC)</span><button class="btn-ic" onclick="TOC.build(document.getElementById('editor').value)">â†»</button></div>
  <div id="toc-list"><div style="padding:12px;color:var(--tx3);font-size:12px">í—¤ë”©(#) ì¶”ê°€ ì‹œ ìë™ ìƒì„±</div></div>
  <div id="sb-stats"><span id="sw">0 ë‹¨ì–´</span><span id="sc">0 ì</span><span id="sp">ì•½ 0 í˜ì´ì§€</span></div>
</nav>

<!-- MAIN -->
<main id="main">
  <div id="find-bar">
    <span style="font-size:11px;color:var(--tx3)">ì°¾ê¸°</span>
    <input id="fi" type="text" placeholder="ê²€ìƒ‰ì–´..." onkeydown="App.findKey(event)">
    <span style="font-size:11px;color:var(--tx3)">ë°”ê¾¸ê¸°</span>
    <input id="ri" type="text" placeholder="ë°”ê¿€ ë‚´ìš©...">
    <button class="btn btn-g btn-sm" onclick="App.findNext()">ë‹¤ìŒ</button>
    <button class="btn btn-g btn-sm" onclick="App.replaceOne()">ë°”ê¾¸ê¸°</button>
    <button class="btn btn-g btn-sm" onclick="App.replaceAll()">ëª¨ë‘</button>
    <button class="btn-ic" onclick="App.toggleFind()">âœ•</button>
    <span id="fc-cnt" style="font-size:11px;color:var(--tx3)"></span>
  </div>
  <div id="editor-wrap">
    <div id="editor-pane">
      <div id="ed-hdr"><span class="pane-lbl"><span></span>MARKDOWN</span></div>
      <div id="ed-container">
        <div id="line-numbers"><div class="lnc" id="lnc"></div></div>
        <textarea id="editor" placeholder="# ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”&#10;&#10;ì—¬ê¸°ì— Markdownì„ ì‘ì„±í•˜ì„¸ìš”.&#10;Shift+? â†’ ë‹¨ì¶•í‚¤ ëª©ë¡" spellcheck="false"></textarea>
      </div>
    </div>
    <div id="preview-pane">
      <div id="pv-hdr">
        <span class="pane-lbl"><span style="background:var(--ac2)"></span>PREVIEW â€” A4 ë‹¤ì¤‘ í˜ì´ì§€</span>
        <span class="spacer"></span>
        <span id="pg-cnt" style="font-size:10px;color:var(--tx3)"></span>
        <span id="render-ts" style="font-size:10px;color:var(--tx3);margin-left:8px"></span>
      </div>
      <div id="preview-container"></div>
    </div>
  </div>
  <div id="error-panel">
    <div id="ep-hdr"><span>âš  ì˜¤ë¥˜</span><button class="btn-ic" onclick="App.closeErr()">âœ•</button></div>
    <div id="ep-list"></div>
  </div>
</main>

<!-- STATUSBAR -->
<div id="statusbar">
  <div class="si" id="autosave-indicator"><div class="save-dot" id="save-dot"></div><span id="save-st">ì €ì¥ë¨</span></div>
  <div class="ss">|</div><div class="si" id="cursor-pos">ì¤„ 1, ì—´ 1</div>
  <div class="ss">|</div><div class="si" id="sel-info"></div>
  <div class="ssp"></div>
  <div class="si" id="error-count" onclick="App.toggleErr()"></div>
  <div class="ss" id="ec-sep" style="display:none">|</div>
  <div class="si">UTF-8</div><div class="ss">|</div>
  <div class="si" id="mode-ind">NORMAL</div>
</div>
</div><!-- #app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- HOTKEY OVERLAY -->
<div id="hk-overlay" onclick="App.hideHK()">
  <div id="hk-panel" onclick="event.stopPropagation()">
    <h2>ë‹¨ì¶•í‚¤ ì•ˆë‚´ <button class="btn-ic" onclick="App.hideHK()">âœ•</button></h2>
    <div class="hk-s">ë¬¸ì„œ êµ¬ì¡°</div>
    <div class="hk-grid">
      <div class="hk-item"><span class="hk-desc">H1/H2/H3</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>Alt</kbd><kbd>1~3</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">í˜ì´ì§€ ë‚˜ëˆ„ê¸°</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>Enter</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ì¤„ë°”ê¿ˆ(&lt;br&gt;)</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>Enter</kbd></div></div>
    </div>
    <div class="hk-s">ì„œì‹</div>
    <div class="hk-grid">
      <div class="hk-item"><span class="hk-desc">Smart Bold</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>B</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ê¸°ìš¸ì„ê¼´</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>I</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ì¸ë¼ì¸ ì½”ë“œ `code`</span><div class="hk-keys"><kbd>Alt</kbd><kbd>V</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ì½”ë“œ ì§ì ‘ ì‚½ì… (ë§ˆì§€ë§‰ ì–¸ì–´)</span><div class="hk-keys"><kbd>Alt</kbd><kbd>C</kbd></div></div>
    </div>
    <div class="hk-s">ê¸°íƒ€</div>
    <div class="hk-grid">
      <div class="hk-item"><span class="hk-desc">ì¸ìš© ì‚½ì…</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>C</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ìƒˆì°½ ë¯¸ë¦¬ë³´ê¸°</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>P</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ì €ì¥ ë‹¤ì´ì–¼ë¡œê·¸</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>S</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ì°¾ê¸°/ë°”ê¾¸ê¸°</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>F</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">Research Mode</span><div class="hk-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>R</kbd></div></div>
      <div class="hk-item"><span class="hk-desc">ë‹¨ì¶•í‚¤ ëª©ë¡</span><div class="hk-keys"><kbd>Shift</kbd><kbd>?</kbd></div></div>
    </div>
    <div style="margin-top:10px;font-size:11px;color:var(--tx3)">í‘œ ë‚´ë¶€: Tabâ†’ë‹¤ìŒ ì…€ | Enterâ†’ìƒˆ í–‰ | âŒ¨ Code ë²„íŠ¼â†’ì–¸ì–´ ì„ íƒ | Alt+Câ†’ë§ˆì§€ë§‰ ì–¸ì–´ ì§ì ‘ ì‚½ì…</div>
  </div>
</div>

<!-- SAVE DIALOG -->
<div class="ov" id="save-modal">
  <div class="modal" style="max-width:400px">
    <h3>ğŸ’¾ ì €ì¥ í˜•ì‹ ì„ íƒ</h3>
    <div style="display:flex;flex-direction:column;gap:9px;margin-bottom:16px">
      <button class="btn btn-g" style="justify-content:flex-start;padding:11px 14px;gap:10px" onclick="App.saveMD()">
        <span style="font-size:18px">ğŸ“</span>
        <div style="text-align:left"><div style="font-weight:600;font-size:13px">Markdown (.md)</div><div style="font-size:11px;color:var(--tx2)">ì›ë³¸ ë§ˆí¬ë‹¤ìš´ íŒŒì¼</div></div>
      </button>
      <button class="btn btn-g" style="justify-content:flex-start;padding:11px 14px;gap:10px" onclick="App.saveTXT()">
        <span style="font-size:18px">ğŸ“„</span>
        <div style="text-align:left"><div style="font-weight:600;font-size:13px">Plain Text (.txt)</div><div style="font-size:11px;color:var(--tx2)">ë§ˆí¬ë‹¤ìš´ ê¸°í˜¸ ì œê±°í•œ í…ìŠ¤íŠ¸</div></div>
      </button>
      <button class="btn btn-g" style="justify-content:flex-start;padding:11px 14px;gap:10px" onclick="App.saveHTML()">
        <span style="font-size:18px">ğŸŒ</span>
        <div style="text-align:left"><div style="font-weight:600;font-size:13px">HTML (.html)</div><div style="font-size:11px;color:var(--tx2)">A4 ë‹¤ì¤‘ í˜ì´ì§€ ìŠ¤íƒ€ì¼ í¬í•¨</div></div>
      </button>
      <button class="btn btn-g" style="justify-content:flex-start;padding:11px 14px;gap:10px" onclick="App.printDoc()">
        <span style="font-size:18px">ğŸ–¨ï¸</span>
        <div style="text-align:left"><div style="font-weight:600;font-size:13px">ì¸ì‡„ / PDFë¡œ ì €ì¥</div><div style="font-size:11px;color:var(--tx2)">ë¸Œë¼ìš°ì € ì¸ì‡„ì°½ â†’ PDF ì €ì¥ ê°€ëŠ¥ (ì „ì²´ í˜ì´ì§€)</div></div>
      </button>
      <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;background:var(--bg3);border-radius:var(--r);border:1px solid var(--bd)">
        <span style="font-size:16px">ğŸ”–</span>
        <div style="flex:1;text-align:left">
          <div style="font-weight:600;font-size:12px;color:var(--tx)">ì£¼ì„([^n]) í‘œì‹œ ì„¤ì •</div>
          <div style="font-size:11px;color:var(--tx2);margin-top:2px">ì €ì¥Â·ì¸ì‡„ ì‹œ ê°ì£¼ í‘œì‹œ ì—¬ë¶€</div>
        </div>
        <label style="display:flex;align-items:center;gap:5px;cursor:pointer;font-size:12px;color:var(--tx2)">
          <input type="checkbox" id="show-footnotes-chk" checked style="accent-color:var(--ac)"> í‘œì‹œ
        </label>
      </div>
    </div>
    <div class="mf"><button class="btn btn-g btn-sm" onclick="App.hideModal('save-modal')">ë‹«ê¸°</button></div>
  </div>
</div>

<!-- CITATION MANAGER -->
<div class="ov" id="cite-modal">
  <div class="modal xl">
    <h3>ğŸ“š ì°¸ê³ ë¬¸í—Œ ê´€ë¦¬ &amp; ì¸ìš© ì‚½ì…</h3>
    <div class="tab-row">
      <div class="tab active" onclick="CM.tab('add')">â‘  ì°¸ê³ ë¬¸í—Œ ì¶”ê°€</div>
      <div class="tab" onclick="CM.tab('cite')">â‘¡ ì¸ìš© ì‚½ì…</div>
      <div class="tab" onclick="CM.tab('convert')">â‘¢ ìŠ¤íƒ€ì¼ ë³€í™˜</div>
      <div class="tab" onclick="CM.tab('lib')">â‘£ ì €ì¥ëœ ëª©ë¡</div>
    </div>

    <!-- ADD -->
    <div class="tp active" id="cp-add">
      <div class="fg">
        <label class="fl">ì…ë ¥ êµ¬ë¶„ ë°©ì‹</label>
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <button id="sep-blank-btn" class="btn btn-tog active btn-sm" style="flex:1" onclick="CM.setSep('blank')">
            ğŸ“‹ ë¹ˆ ì¤„ë¡œ êµ¬ë¶„<br><span style="font-size:10px;color:inherit;opacity:.8">í•­ëª© ì‚¬ì´ì— ë¹ˆ ì¤„ 1ê°œ</span>
          </button>
          <button id="sep-line-btn" class="btn btn-tog btn-sm" style="flex:1" onclick="CM.setSep('line')">
            â†µ ì—”í„°(ì¤„ë°”ê¿ˆ)ë¡œ êµ¬ë¶„<br><span style="font-size:10px;color:inherit;opacity:.8">ê° ì¤„ = 1ê°œ ì°¸ê³ ë¬¸í—Œ</span>
          </button>
        </div>
      </div>
      <div class="fg">
        <label class="fl">APA í˜•ì‹ ì°¸ê³ ë¬¸í—Œ ë¶™ì—¬ë„£ê¸°</label>
        <textarea id="cite-raw" class="fi" style="min-height:130px" placeholder="ì—¬ê¸°ì— ì°¸ê³ ë¬¸í—Œì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        <div style="display:flex;gap:8px;margin-top:7px;align-items:center;flex-wrap:wrap">
          <button class="btn btn-p btn-sm" onclick="CM.parse()">ì•±ì—ì„œ ì‚¬ìš©í•˜ê¸° â†’</button>
          <button class="btn btn-g btn-sm" onclick="document.getElementById('cite-raw').value=''">ì§€ìš°ê¸°</button>
          <label class="btn btn-g btn-sm" style="cursor:pointer">ğŸ“ TXT ë¶ˆëŸ¬ì˜¤ê¸°<input type="file" accept=".txt,.bib,.ris" style="display:none" onchange="CM.loadFile(event)"></label>
          <span id="cite-msg" style="font-size:11px;color:var(--ok)"></span>
        </div>
        <div style="margin-top:7px;font-size:11px;color:var(--tx3)" id="sep-desc">í˜„ì¬: ë¹ˆ ì¤„ë¡œ êµ¬ë¶„ â€” í•­ëª© ì‚¬ì´ì— ë¹ˆ ì¤„ í•˜ë‚˜ë¥¼ ë„£ì–´ êµ¬ë¶„í•˜ì„¸ìš”.</div>
      </div>
    </div>

    <!-- CITE -->
    <div class="tp" id="cp-cite">
      <div style="display:flex;gap:7px;margin-bottom:9px;align-items:center">
        <input type="text" id="cite-search" class="fi" style="flex:1" placeholder="ì €ì, ì—°ë„, í‚¤ì›Œë“œë¡œ ê²€ìƒ‰..." oninput="CM.filter()">
        <button class="btn btn-g btn-sm" onclick="CM.selAll()">ì „ì²´ ì„ íƒ</button>
        <button class="btn btn-g btn-sm" onclick="CM.clrSel()">ì„ íƒ í•´ì œ</button>
      </div>
      <div id="cite-list-area"><div class="cite-empty">ì¶”ê°€ íƒ­ì—ì„œ ë¨¼ì € ì°¸ê³ ë¬¸í—Œì„ ì…ë ¥í•˜ì„¸ìš”.</div></div>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px">
        <label style="font-size:12px;color:var(--tx2)">ì‚½ì… í˜•ì‹:</label>
        <select id="cite-style" class="fi" style="width:auto;padding:4px 8px">
          <option value="inline">ì¸ë¼ì¸: (ì €ì, ì—°ë„)</option>
          <option value="narrative">ì„œìˆ í˜•: ì €ì(ì—°ë„)</option>
          <option value="multi">ë³µìˆ˜: (A, ì—°ë„; B, ì—°ë„)</option>
          <option value="footnote">ê°ì£¼: [^n]</option>
        </select>
        <span id="cite-sc" style="font-size:11px;color:var(--tx3);margin-left:auto">0ê°œ ì„ íƒë¨</span>
      </div>
    </div>

    <!-- CONVERT -->
    <div class="tp" id="cp-convert">
      <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;flex-wrap:wrap">
        <label style="font-size:12px;color:var(--tx2)">ì…ë ¥ ìŠ¤íƒ€ì¼:</label>
        <select id="from-style" class="fi" style="width:auto;padding:4px 8px">
          <option value="apa" selected>APA 7 (ê¸°ë³¸)</option>
          <option value="mla">MLA 9</option>
          <option value="chicago">Chicago (Author-Date)</option>
          <option value="vancouver">Vancouver</option>
        </select>
        <span style="font-size:12px;color:var(--tx2)">â†’ ë³€í™˜ ëŒ€ìƒ:</span>
        <select id="to-style" class="fi" style="width:auto;padding:4px 8px">
          <option value="mla" selected>MLA 9</option>
          <option value="apa">APA 7</option>
          <option value="chicago">Chicago (Author-Date)</option>
          <option value="vancouver">Vancouver</option>
        </select>
        <button class="btn btn-p btn-sm" onclick="CM.convertStyle()">ë³€í™˜</button>
      </div>
      <div class="fg">
        <label class="fl">ë³€í™˜í•  ì°¸ê³ ë¬¸í—Œ (ì €ì¥ ëª©ë¡ ë¯¸ì„ íƒ ì‹œ ì§ì ‘ ì…ë ¥)</label>
        <textarea id="conv-input" class="fi" style="min-height:80px" placeholder="Kim, J. H., &amp; Lee, S. (2023). SEM in education. Journal of Educational Research, 45(2), 123â€“145."></textarea>
      </div>
      <div class="fg">
        <label class="fl">ë³€í™˜ ê²°ê³¼ <span id="conv-label" style="color:var(--ac);font-weight:600"></span></label>
        <textarea id="conv-output" class="fi" style="min-height:80px" readonly placeholder="ë³€í™˜ ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-g btn-sm" onclick="CM.copyConverted()">ğŸ“‹ ë³µì‚¬</button>
        <button class="btn btn-p btn-sm" onclick="CM.insertConverted()">ì—ë””í„°ì— ì‚½ì…</button>
      </div>
    </div>

    <!-- LIB -->
    <div class="tp" id="cp-lib">
      <div style="display:flex;gap:7px;margin-bottom:9px;align-items:center;flex-wrap:wrap">
        <span style="font-size:12px;color:var(--tx2)">ì €ì¥ <span id="lib-cnt" style="color:var(--ac);font-weight:600">0</span>ê±´</span>
        <span class="spacer"></span>
        <button class="btn btn-g btn-sm" onclick="CM.insertRefSection()">ğŸ“„ ì°¸ê³ ë¬¸í—Œ ì„¹ì…˜ ì‚½ì…</button>
        <button class="btn btn-g btn-sm" onclick="CM.downloadLib()">â¬‡ ëª©ë¡ ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn btn-g btn-sm" style="color:var(--er)" onclick="CM.clearAll()">ì „ì²´ ì‚­ì œ</button>
      </div>
      <div id="lib-list"><div class="cite-empty">ì €ì¥ëœ ì°¸ê³ ë¬¸í—Œì´ ì—†ìŠµë‹ˆë‹¤.</div></div>
    </div>

    <div class="mf">
      <button class="btn btn-g btn-sm" onclick="App.hideModal('cite-modal')">ë‹«ê¸°</button>
      <button class="btn btn-p btn-sm" id="cite-ins-btn" onclick="CM.insert()" style="display:none">âœ” ì„ íƒ í•­ëª© ì¸ìš© ì‚½ì…</button>
    </div>
  </div>
</div>

<!-- CODE MODAL (toolbar button) -->
<div class="ov" id="code-modal">
  <div class="modal" style="max-width:380px">
    <h3>ì½”ë“œ ë¸”ë¡ ì–¸ì–´ ì„ íƒ</h3>
    <div class="mb">
      <select class="fi" id="code-lang">
        <option value="">ì—†ìŒ</option><option value="python">Python</option><option value="javascript">JavaScript</option>
        <option value="typescript">TypeScript</option><option value="java">Java</option><option value="c">C</option>
        <option value="cpp">C++</option><option value="r">R</option><option value="matlab">MATLAB</option>
        <option value="sql">SQL</option><option value="bash">Bash/Shell</option><option value="latex">LaTeX</option>
        <option value="html">HTML</option><option value="css">CSS</option><option value="json">JSON</option>
        <option value="yaml">YAML</option><option value="markdown">Markdown</option>
      </select>
    </div>
    <div class="mf">
      <button class="btn btn-g btn-sm" onclick="App.hideModal('code-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-p btn-sm" onclick="ED.codeBlockModal()">ì‚½ì…</button>
    </div>
  </div>
</div>

<!-- LINK MODAL -->
<div class="ov" id="link-modal">
  <div class="modal" style="max-width:420px">
    <h3>ğŸ”— ë§í¬ ì‚½ì… <span style="font-size:11px;color:var(--ac2)">(ìƒˆ íƒ­)</span></h3>
    <div class="mb">
      <div class="fg"><label class="fl">í‘œì‹œ í…ìŠ¤íŠ¸</label><input class="fi" id="link-text" type="text" placeholder="ë§í¬ í…ìŠ¤íŠ¸"></div>
      <div class="fg"><label class="fl">URL</label><input class="fi" id="link-url" type="text" placeholder="https://..."></div>
    </div>
    <div class="mf">
      <button class="btn btn-g btn-sm" onclick="App.hideModal('link-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-p btn-sm" onclick="ED.link()">ì‚½ì…</button>
    </div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div class="ov" id="image-modal">
  <div class="modal" style="max-width:480px">
    <h3>ğŸ–¼ ì´ë¯¸ì§€ ì‚½ì…</h3>
    <!-- Drag & Drop Zone -->
    <div id="img-dropzone" style="border:2px dashed var(--bd);border-radius:8px;padding:20px;text-align:center;margin-bottom:14px;cursor:pointer;transition:all .2s;background:var(--bg3)" onclick="document.getElementById('img-file-input').click()" ondragover="IMG.dragOver(event)" ondragleave="IMG.dragLeave(event)" ondrop="IMG.drop(event)">
      <div id="img-drop-text" style="font-size:13px;color:var(--tx2)">ğŸ–¼ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì„ íƒ</div>
      <div style="font-size:11px;color:var(--tx3);margin-top:4px">PNG, JPG, GIF, WebP ì§€ì› Â· Base64ë¡œ ìë™ ì‚½ì…</div>
      <input type="file" id="img-file-input" accept="image/*" style="display:none" onchange="IMG.fileSelected(event)">
    </div>
    <div id="img-preview-wrap" style="display:none;margin-bottom:12px;text-align:center">
      <img id="img-preview" style="max-width:100%;max-height:160px;border-radius:4px;border:1px solid var(--bd)">
    </div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
      <div style="flex:1;height:1px;background:var(--bd)"></div>
      <span style="font-size:11px;color:var(--tx3)">ë˜ëŠ” URL ì…ë ¥</span>
      <div style="flex:1;height:1px;background:var(--bd)"></div>
    </div>
    <div class="mb">
      <div class="fg"><label class="fl">Alt í…ìŠ¤íŠ¸</label><input class="fi" id="img-alt" type="text" placeholder="ì´ë¯¸ì§€ ì„¤ëª…"></div>
      <div class="fg"><label class="fl">URL ë˜ëŠ” ê²½ë¡œ</label><input class="fi" id="img-url" type="text" placeholder="https://..."></div>
    </div>
    <div class="mf">
      <button class="btn btn-g btn-sm" onclick="App.hideModal('image-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-p btn-sm" onclick="ED.image()">ì‚½ì…</button>
    </div>
  </div>
</div>

<!-- COLOR PICKER MODAL -->
<div class="ov" id="color-modal">
  <div class="modal" style="max-width:380px">
    <h3 id="color-modal-title">ê¸€ì ìƒ‰ìƒ ì„¤ì •</h3>
    <div class="fg">
      <label class="fl">ë¹ ë¥¸ ì„ íƒ</label>
      <div class="csw-row" id="color-swatches"></div>
    </div>
    <div class="fg">
      <label class="fl">ì§ì ‘ ì…ë ¥ (Hex ë˜ëŠ” ìƒ‰ìƒëª…)</label>
      <input class="fi" id="color-hex" type="text" placeholder="#ff0000" style="font-family:var(--fm)">
    </div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
      <label class="fl" style="margin:0">ë¯¸ë¦¬ë³´ê¸°:</label>
      <div id="color-preview" style="padding:4px 12px;border-radius:4px;font-size:13px;border:1px solid var(--bd)">ìƒ˜í”Œ í…ìŠ¤íŠ¸</div>
    </div>
    <div class="mf">
      <button class="btn btn-g btn-sm" onclick="App.hideModal('color-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-p btn-sm" onclick="App.applyColor()">ì ìš©</button>
    </div>
  </div>
</div>

<!-- CAPTION MODAL -->
<div class="ov" id="caption-modal">
  <div class="modal" style="max-width:520px">
    <h3 id="cap-title">í‘œ ìº¡ì…˜ ì‚½ì…</h3>
    <div class="fg">
      <label class="fl">í˜•ì‹ ì„ íƒ (í´ë¦­ìœ¼ë¡œ ì„ íƒ)</label>
      <div id="cap-opts" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:4px"></div>
    </div>
    <div style="display:flex;gap:10px;margin-bottom:10px">
      <div class="fg" style="flex:0 0 80px">
        <label class="fl">ë²ˆí˜¸</label>
        <input class="fi" id="cap-num" type="text" placeholder="1" oninput="App.updateCapPreview()">
      </div>
      <div class="fg" style="flex:1">
        <label class="fl">ì„¤ëª… / ì œëª©</label>
        <input class="fi" id="cap-desc" type="text" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="App.updateCapPreview()">
      </div>
    </div>
    <div class="fg">
      <label class="fl">ë¯¸ë¦¬ë³´ê¸°</label>
      <div id="cap-preview" style="background:var(--bg3);border:1px solid var(--bd);border-radius:var(--r);padding:8px 12px;font-family:var(--fm);font-size:12px;color:var(--tx);min-height:28px"></div>
    </div>
    <div class="mf">
      <button class="btn btn-g btn-sm" onclick="App.hideModal('caption-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-p btn-sm" onclick="App.insertCaption()">ì‚½ì…</button>
    </div>
  </div>
</div>

<!-- TEMPLATE MODAL -->
<div class="ov" id="tmpl-modal">
  <div class="modal lg">
    <h3>ğŸ“‹ ë…¼ë¬¸ ì–‘ì‹ ì„ íƒ</h3>
    <p style="font-size:12px;color:var(--tx2);margin-bottom:14px">ì„ íƒí•˜ë©´ ì—ë””í„°ì— êµ¬ì¡°ê°€ ìë™ ì‚½ì…ë©ë‹ˆë‹¤. ê¸°ì¡´ ë‚´ìš©ì€ ìœ ì§€ë©ë‹ˆë‹¤.</p>
    <div class="tmpl-grid" id="tmpl-grid"></div>
    <div class="mf"><button class="btn btn-g btn-sm" onclick="App.hideModal('tmpl-modal')">ë‹«ê¸°</button></div>
  </div>
</div>

<div id="tooltip"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UNDO STACK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const US=(()=>{
  const MAX=500;let st=[],ptr=-1;
  const snap=()=>{const e=el('editor');push(e.value,[e.selectionStart,e.selectionEnd])};
  function push(v,s){st=st.slice(0,ptr+1);st.push({v,s});if(st.length>MAX)st.shift();else ptr++}
  function undo(){if(ptr<=0)return;ptr--;const s=st[ptr];el('editor').value=s.v;el('editor').setSelectionRange(s.s[0],s.s[1]);App.render()}
  function redo(){if(ptr>=st.length-1)return;ptr++;const s=st[ptr];el('editor').value=s.v;el('editor').setSelectionRange(s.s[0],s.s[1]);App.render()}
  return{snap,undo,redo};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function el(id){return document.getElementById(id)}
function ins(ed,s,e,text){ed.value=ed.value.substring(0,s)+text+ed.value.substring(e);const p=s+text.length;ed.setSelectionRange(p,p);ed.focus();App.render();US.snap()}
function getCL(ed){const pos=ed.selectionStart,bef=ed.value.substring(0,pos);const ls=bef.lastIndexOf('\n')+1,aft=ed.value.substring(pos);const le=pos+(aft.indexOf('\n')===-1?aft.length:aft.indexOf('\n'));return{ls,le,text:ed.value.substring(ls,le)}}
function repCL(ed,t){const{ls,le}=getCL(ed);ed.value=ed.value.substring(0,ls)+t+ed.value.substring(le);const p=ls+t.length;ed.setSelectionRange(p,p);ed.focus();App.render();US.snap()}
function dlBlob(content,filename,type){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([content],{type}));a.download=filename;a.click()}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MARKED SETUP â€” links new tab
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
marked.setOptions({breaks:true,gfm:true});
const _r=new marked.Renderer();
_r.heading=(text,level)=>{const id='h-'+text.toLowerCase().replace(/[^a-z0-9ê°€-í£\s]/g,'').replace(/\s+/g,'-').substring(0,50);return`<h${level} id="${id}">${text}</h${level}>`;};
_r.link=(href,title,text)=>`<a href="${href}"${title?` title="${title}"`:''} target="_blank" rel="noopener noreferrer">${text}</a>`;
marked.use({renderer:_r});
function mdRender(md,showFootnotes){
  try{
    // Process footnotes: highlight [^n] references and collect definitions
    let fnDefs={};let fnCounter=0;
    // Collect footnote definitions [^n]: text
    md=md.replace(/^\[\^([^\]]+)\]:\s*(.+)$/gm,(m,key,text)=>{fnDefs[key]=text;return'__FN_DEF_'+key+'__'});
    // Replace inline [^n] with highlighted spans
    md=md.replace(/\[\^([^\]]+)\]/g,(m,key)=>{
      fnCounter++;
      return`<sup class="footnote-highlight" title="${fnDefs[key]||''}">[${fnCounter}]</sup>`;
    });
    // Remove def placeholders (they'll be added to footnotes section)
    md=md.replace(/__FN_DEF_[^_]+__\n?/g,'');
    let html=marked.parse(md||'');
    // Append footnotes section if there are definitions and showFootnotes is not false
    if(Object.keys(fnDefs).length>0 && showFootnotes!==false){
      let fnHtml='<div class="footnotes-section">';
      let i=1;
      Object.entries(fnDefs).forEach(([k,v])=>{fnHtml+=`<div class="footnote-def"><sup>[${i}]</sup> ${v}</div>`;i++});
      fnHtml+='</div>';
      html+=fnHtml;
    }
    return html;
  }catch(e){return`<p style="color:red">${e.message}</p>`;}
}
/* PAGE SPLIT */
function splitPages(md){const p=md.replace(/\r\n/g,'\n').split(/\n?<div class="page-break"><\/div>\n?/);return p.length?p:[md]}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PREVIEW RENDERER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PR={
  rm:false,
  render(md,showFootnotes){
    if(showFootnotes===undefined)showFootnotes=true;
    const c=el('preview-container');const pages=splitPages(md);c.innerHTML='';
    pages.forEach((p,i)=>{
      const div=document.createElement('div');
      div.className='preview-page'+(this.rm?' rm':'');div.dataset.page=i+1;
      div.innerHTML=mdRender(p,showFootnotes);
      div.querySelectorAll('a').forEach(a=>{a.target='_blank';a.rel='noopener noreferrer'});
      c.appendChild(div);
    });
    if(window.MathJax)MathJax.typesetPromise([c]).catch(()=>{});
    el('pg-cnt').textContent=`${pages.length} í˜ì´ì§€`;
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PREVIEW WINDOW (popup) + scroll sync
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PW=(()=>{
  let win=null,st=null,rm=false;
  const CSS=`@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');
*{box-sizing:border-box;margin:0;padding:0}body{font-family:sans-serif;background:#6a6e7e;display:flex;flex-direction:column;align-items:center;padding:16px 0 36px;min-height:100vh}
.preview-page{width:210mm;min-height:297mm;background:white;color:#1a1a2e;padding:22mm 18mm;box-shadow:0 6px 40px rgba(0,0,0,.5);font-family:'Libre Baskerville',serif;font-size:11pt;line-height:1.8;word-break:break-word;position:relative;margin-bottom:16px}
.preview-page::after{content:"â€” " attr(data-page) " â€”";position:absolute;bottom:10mm;left:50%;transform:translateX(-50%);font-family:sans-serif;font-size:9pt;color:#bbb}
.preview-page h1{font-size:21pt;font-weight:700;margin:0 0 14px;border-bottom:2px solid #1a1a2e;padding-bottom:8px}
.preview-page h2{font-size:15pt;font-weight:700;margin:20px 0 10px}.preview-page h3{font-size:12pt;font-weight:700;margin:16px 0 7px}
.preview-page p{margin:0 0 11px}.preview-page ul,.preview-page ol{margin:0 0 11px;padding-left:22px}.preview-page li{margin-bottom:3px}
.preview-page blockquote{border-left:3px solid #5b4ce4;margin:14px 0;padding:7px 14px;background:#f5f5ff;font-style:italic}
.preview-page code{font-family:'JetBrains Mono',monospace;font-size:9pt;background:#f0f0f8;padding:1px 4px;border-radius:3px;color:#5b4ce4}
.preview-page pre{background:#1a1a2e;color:#e8e8f0;padding:14px;border-radius:6px;overflow-x:auto;margin:11px 0;font-size:9pt}
.preview-page pre code{background:none;color:inherit;padding:0}
.preview-page table{width:100%;border-collapse:collapse;margin:11px 0;font-size:10pt}
.preview-page th{background:#1a1a2e;color:#fff;padding:7px 11px;text-align:left}
.preview-page td{padding:6px 11px;border:1px solid #d0d0e0}
.preview-page tr:nth-child(even) td{background:#f7f7fc}
.preview-page img{max-width:100%}
.preview-page a{color:#5b4ce4;text-decoration:underline}
.preview-page a[href^="http"]::after{content:" â†—";font-size:8pt;opacity:.5}
.preview-page .ref-block{border-top:1px solid #d0d0e0;margin-top:28px;padding-top:10px;font-size:9pt;color:#4a4a6a}
.preview-page.rm{counter-reset:pln}
.preview-page.rm>p{counter-increment:pln;padding-left:36px;position:relative}
.preview-page.rm>p::before{content:counter(pln);position:absolute;left:0;top:0;font-family:'JetBrains Mono',monospace;font-size:8.5pt;color:#b0b0c8;min-width:28px;text-align:right;border-right:1px solid #ddd;padding-right:6px}
@media print{body{background:none;padding:0}.preview-page{box-shadow:none;margin:0;page-break-after:always;width:100%;min-height:0}.preview-page:last-child{page-break-after:auto}.preview-page::after{display:none}}`;

  function buildHTML(md,title){
    const pages=splitPages(md);
    const html=pages.map((p,i)=>`<div class="preview-page${rm?' rm':''}" data-page="${i+1}">${mdRender(p)}</div>`).join('');
    return`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>${title||'Preview'}</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"><\/script>
<style>${CSS}<\/style></head><body>${html}
<script>
document.querySelectorAll('a').forEach(a=>{a.target='_blank';a.rel='noopener noreferrer'});
window.addEventListener('message',e=>{if(e.data&&e.data.type==='ss')window.scrollTo(0,e.data.ratio*(document.body.scrollHeight-window.innerHeight))});
let _st;window.addEventListener('scroll',()=>{clearTimeout(_st);_st=setTimeout(()=>{const r=window.scrollY/Math.max(1,document.body.scrollHeight-window.innerHeight);try{window.opener.postMessage({type:'pvS',ratio:r},'*')}catch(e){}},10)},{passive:true});
<\/script></body></html>`;
  }

  function open(){
    const title=el('doc-title').value;
    if(win&&!win.closed){win.focus();sync();return}
    const w=920,h=Math.floor(window.screen.height*.88);
    const left=window.screenX+window.outerWidth+10,top=window.screenY;
    try{
      win=window.open('','md_pv_v7',`width=${w},height=${h},left=${left},top=${top},resizable=yes,scrollbars=yes`);
      if(!win)throw 0;
      win.document.open();win.document.write(buildHTML(el('editor').value,title));win.document.close();
      el('pw-btn').classList.add('open');
      win.addEventListener('beforeunload',()=>el('pw-btn').classList.remove('open'));
      window.addEventListener('message',e=>{if(e.data&&e.data.type==='pvS'){const r=e.data.ratio;const ed2=el('editor');ed2.scrollTop=r*(ed2.scrollHeight-ed2.clientHeight);const pc=el('preview-container');pc.scrollTop=r*(pc.scrollHeight-pc.clientHeight)}});
    }catch(e){alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');}
  }

  function pushScroll(r){if(!win||win.closed)return;try{win.postMessage({type:'ss',ratio:r},'*')}catch(e){}}

  function sync(){
    clearTimeout(st);st=setTimeout(()=>{
      if(!win||win.closed){el('pw-btn').classList.remove('open');return}
      const title=el('doc-title').value;
      try{const sy=win.scrollY,sh=win.document.body.scrollHeight,ih=win.innerHeight,r=sy/Math.max(1,sh-ih);
        win.document.open();win.document.write(buildHTML(el('editor').value,title));win.document.close();
        setTimeout(()=>{if(!win||win.closed)return;win.scrollTo(0,r*(win.document.body.scrollHeight-win.innerHeight))},150);
      }catch(e){}
    },200);
  }

  function forceRefresh(){if(win&&!win.closed){const t=el('doc-title').value;try{win.document.open();win.document.write(buildHTML(el('editor').value,t));win.document.close()}catch(e){}}else open()}
  function checkClosed(){if(win&&win.closed)el('pw-btn').classList.remove('open')}
  function setRM(v){rm=v}
  return{open,sync,forceRefresh,checkClosed,pushScroll,setRM};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL SYNC (editor â†” inline preview â†” popup)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SS=(()=>{
  let el2=false,pl=false,t=null;
  function init(){
    const ed=el('editor'),pc=el('preview-container');
    ed.addEventListener('scroll',()=>{if(pl)return;clearTimeout(t);t=setTimeout(()=>{const r=ed.scrollTop/Math.max(1,ed.scrollHeight-ed.clientHeight);pl=true;pc.scrollTop=r*(pc.scrollHeight-pc.clientHeight);PW.pushScroll(r);setTimeout(()=>pl=false,60)},5)},{passive:true});
    pc.addEventListener('scroll',()=>{if(el2)return;clearTimeout(t);t=setTimeout(()=>{const r=pc.scrollTop/Math.max(1,pc.scrollHeight-pc.clientHeight);el2=true;const ed2=el('editor');ed2.scrollTop=r*(ed2.scrollHeight-ed2.clientHeight);PW.pushScroll(r);setTimeout(()=>el2=false,60)},5)},{passive:true});
  }
  return{init};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOC
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TOC=(()=>{
  let obs=null;
  function build(md){
    const list=el('toc-list');const hs=[];const cnt=[0,0,0];
    md.split('\n').forEach(line=>{const m=line.match(/^(#{1,3})\s+(.+)/);if(!m)return;const lv=m[1].length,text=m[2].replace(/[*_`]/g,'');const id='h-'+text.toLowerCase().replace(/[^a-z0-9ê°€-í£\s]/g,'').replace(/\s+/g,'-').substring(0,50);cnt[lv-1]++;for(let i=lv;i<3;i++)cnt[i]=0;const num=lv===1?cnt[0]:lv===2?`${cnt[0]}.${cnt[1]}`:`${cnt[0]}.${cnt[1]}.${cnt[2]}`;hs.push({lv,text,id,num})});
    if(!hs.length){list.innerHTML='<div style="padding:12px;color:var(--tx3);font-size:12px">í—¤ë”©(#)ì„ ì¶”ê°€í•˜ë©´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.</div>';return}
    list.innerHTML=hs.map(h=>`<div class="toc-item" data-level="${h.lv}" onclick="TOC.go('${h.id}')"><span class="toc-num">${h.num}</span><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h.text}</span></div>`).join('');
    attachObs();
  }
  function go(id){const e=document.querySelector(`#preview-container #${id}`);if(e){e.scrollIntoView({behavior:'smooth',block:'start'});document.querySelectorAll('.toc-item').forEach(i=>i.classList.remove('active'));document.querySelectorAll(`.toc-item[data-id="${id}"]`).forEach(i=>i.classList.add('active'))}}
  function attachObs(){if(obs)obs.disconnect();const pc=el('preview-container');obs=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){const id=e.target.id;document.querySelectorAll('.toc-item').forEach(i=>i.classList.remove('active'));document.querySelectorAll(`.toc-item[data-id="${id}"]`).forEach(i=>i.classList.add('active'))}})},{root:pc,threshold:.15});pc.querySelectorAll('h1,h2,h3').forEach(h=>obs.observe(h))}
  return{build,go};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LINE NUMBERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LN=(()=>{
  let v=false;
  function update(){if(!v)return;const ed=el('editor'),c=el('lnc');c.innerHTML=ed.value.split('\n').map((_,i)=>`<div class="ln">${i+1}</div>`).join('');el('line-numbers').scrollTop=ed.scrollTop}
  function toggle(){v=!v;el('line-numbers').classList.toggle('vis',v);el('editor').classList.toggle('wln',v);el('ln-btn').classList.toggle('active',v);update()}
  return{update,toggle};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTO SAVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AS=(()=>{
  let t;const K='mdpro_v7';
  function load(){try{const d=JSON.parse(localStorage.getItem(K)||'{}');if(d.c)el('editor').value=d.c;if(d.t)el('doc-title').value=d.t}catch(e){}}
  function save(c,t2){clearTimeout(t);el('save-dot').classList.add('saving');el('save-st').textContent='ì €ì¥ ì¤‘...';t=setTimeout(()=>{try{localStorage.setItem(K,JSON.stringify({c,t:t2,ts:Date.now()}))}catch(e){}el('save-dot').classList.remove('saving');el('save-st').textContent='ì €ì¥ë¨'},1000)}
  return{load,save};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CITATION MANAGER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CM=(()=>{
  const KEY='mdpro_refs';let refs=[];let sep='blank';// blank|line

  function load(){try{refs=JSON.parse(localStorage.getItem(KEY)||'[]')}catch(e){refs=[]}}
  function save(){try{localStorage.setItem(KEY,JSON.stringify(refs))}catch(e){}}

  function setSep(s){
    sep=s;
    el('sep-blank-btn').classList.toggle('active',s==='blank');
    el('sep-line-btn').classList.toggle('active',s==='line');
    const descs={blank:'í˜„ì¬: ë¹ˆ ì¤„ë¡œ êµ¬ë¶„ â€” í•­ëª© ì‚¬ì´ì— ë¹ˆ ì¤„ í•˜ë‚˜ë¥¼ ë„£ì–´ êµ¬ë¶„í•˜ì„¸ìš”.',line:'í˜„ì¬: ì—”í„°(ì¤„ë°”ê¿ˆ)ë¡œ êµ¬ë¶„ â€” ê° ì¤„ì´ í•˜ë‚˜ì˜ ì°¸ê³ ë¬¸í—Œìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.'};
    el('sep-desc').textContent=descs[s];
  }

  /* APA parser */
  function parseAPA(line){
    line=line.trim();if(!line||line.length<10)return null;
    const ym=line.match(/\((\d{4}[a-z]?)\)/);const year=ym?ym[1]:'?';
    let ap=ym?line.substring(0,line.indexOf(ym[0])).trim().replace(/,\s*$/,''):line.split('.')[0];
    const names=ap.split(/,\s*&\s*|;\s*|,\s*(?=[A-Zê°€-í£])/).map(s=>s.trim().split(',')[0].trim()).filter(Boolean);
    let key=names.length===1?`${names[0]}, ${year}`:names.length===2?`${names[0]} & ${names[1]}, ${year}`:`${names[0]} et al., ${year}`;
    return{key,year,author:names[0]||'Unknown',full:line,id:Date.now()+Math.random(),mla:'',chicago:''};
  }

  function parse(){
    const raw=el('cite-raw').value;if(!raw.trim())return;
    let lines;
    if(sep==='blank'){
      // Split by one or more blank lines
      lines=raw.split(/\n[ \t]*\n+/).map(block=>
        block.split('\n').map(l=>l.trim()).filter(Boolean).join(' ')
      ).map(l=>l.replace(/^\d+[\.\)]\s*/,'')).filter(l=>l.length>10);
    }else{
      // Each non-empty line is one reference
      lines=raw.split('\n').map(l=>l.replace(/^\d+[\.\)]\s*/,'').trim()).filter(l=>l.length>10);
    }
    let added=0;
    lines.forEach(l=>{const p=parseAPA(l);if(p&&!refs.find(r=>r.full===p.full)){p.mla=toMLA(p);p.chicago=toChicago(p);refs.push(p);added++}});
    save();
    el('cite-msg').textContent=added?`âœ“ ${added}ê±´ ì¶”ê°€ë¨ (ì´ ${refs.length}ê±´)`:lines.length?'ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ íŒŒì‹± ì‹¤íŒ¨':'ë¹ˆ ì¤„ì´ ì—†ìŠµë‹ˆë‹¤ â€” êµ¬ë¶„ ë°©ì‹ì„ í™•ì¸í•˜ì„¸ìš”';
    setTimeout(()=>el('cite-msg').textContent='',4000);
    renderLib();renderList('');
  }

  function loadFile(ev){
    const file=ev.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=e=>{el('cite-raw').value=e.target.result;};
    reader.readAsText(file,'utf-8');
    ev.target.value='';
  }

  /* Style converters (heuristic) */
  function toMLA(ref){
    // APA: Author, A. A., & Author, B. B. (Year). Title. Journal, Vol(No), pp. DOI
    const m=ref.full.match(/^(.+?)\.\s*\((\d{4}[a-z]?)\)\.\s*(.+?)\.\s*([^,]+),\s*(\d+)\((\d+)\),\s*([\dâ€“\-]+)/);
    if(m){const[,authors,year,title,journal,vol,no,pp]=m;return`${expandAuthors(authors)} "${capTitle(title.trim())}" ${journal}, vol. ${vol}, no. ${no}, ${year}, pp. ${pp}.`}
    // fallback â€” use ref.year (not local year which is out of scope here)
    const fy=ref.year||'?';
    const titlePart=ref.full.replace(/\(.*?\)\./,'').replace(/^[^.]+\.\s*/,'').trim();
    return`${ref.author}. "${titlePart}" ${fy}.`;
  }

  function toChicago(ref){
    const m=ref.full.match(/^(.+?)\.\s*\((\d{4}[a-z]?)\)\.\s*(.+?)\.\s*([^,]+),\s*(\d+)\((\d+)\),\s*([\dâ€“\-]+)/);
    if(m){const[,authors,year,title,journal,vol,no,pp]=m;return`${expandAuthors(authors)} ${year}. "${capTitle(title.trim())}" ${journal} ${vol} (${no}): ${pp}.`}
    return`${ref.author}. ${ref.year}. "${ref.full}."`;
  }

  function toVancouver(ref){
    const m=ref.full.match(/^(.+?)\.\s*\((\d{4}[a-z]?)\)\.\s*(.+?)\.\s*([^,]+),\s*(\d+)\((\d+)\),\s*([\dâ€“\-]+)/);
    if(m){const[,authors,year,title,journal,vol,no,pp]=m;const au=authors.split(/,\s*&\s*|;\s*/).map(s=>s.trim()).join(', ');return`${au}. ${title.trim()}. ${journal}. ${year};${vol}(${no}):${pp}.`}
    return ref.full;
  }

  function expandAuthors(s){return s.replace(/\s*&\s*/g,', and ').replace(/,\s*et\s+al\./,'et al.')}
  function capTitle(t){return t.replace(/\b(\w)/g,(m,c,i)=>i===0||'.:!?'.includes(t[i-1])?c.toUpperCase():m)}

  function convertByStyle(ref,style){
    if(style==='mla')return ref.mla||toMLA(ref);
    if(style==='chicago')return ref.chicago||toChicago(ref);
    if(style==='vancouver')return toVancouver(ref);
    return ref.full;// APA
  }

  function convertStyle(){
    const from=el('from-style').value,to=el('to-style').value;
    const raw=el('conv-input').value.trim();
    if(!raw){el('conv-output').value='ì…ë ¥ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';return}
    const p=parseAPA(raw);if(!p){el('conv-output').value='íŒŒì‹± ì‹¤íŒ¨ â€” APA í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.';return}
    p.mla=toMLA(p);p.chicago=toChicago(p);
    el('conv-output').value=convertByStyle(p,to);
    const labels={apa:'APA 7',mla:'MLA 9',chicago:'Chicago (Author-Date)',vancouver:'Vancouver'};
    el('conv-label').textContent=`â†’ ${labels[to]}`;
  }
  function copyConverted(){const v=el('conv-output').value;if(v)navigator.clipboard.writeText(v).then(()=>{}).catch(()=>{})}
  function insertConverted(){const v=el('conv-output').value;if(!v)return;const ed=el('editor'),pos=ed.selectionEnd;ins(ed,pos,pos,'\n'+v+'\n');App.hideModal('cite-modal')}

  /* List rendering */
  function renderList(q){
    const area=el('cite-list-area');
    const flt=refs.filter(r=>!q||r.full.toLowerCase().includes(q.toLowerCase())||r.key.toLowerCase().includes(q.toLowerCase()));
    if(!flt.length){area.innerHTML='<div class="cite-empty">í•´ë‹¹ ë¬¸í—Œ ì—†ìŒ. ì¶”ê°€ íƒ­ì—ì„œ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.</div>';return}
    area.innerHTML=flt.map(r=>`<div class="cite-entry" onclick="CM.toggle('cb_${r.id}')"><input type="checkbox" id="cb_${r.id}" data-id="${r.id}" onchange="CM.upd()" onclick="event.stopPropagation()"><div class="cite-body"><div class="cite-key">${r.key}</div><div class="cite-full" title="${r.full}">${r.full}</div></div></div>`).join('');
    upd();
  }

  function filter(){renderList(el('cite-search').value)}
  function toggle(id){const cb=el(id);if(cb){cb.checked=!cb.checked;upd()}}
  function getSel(){return Array.from(document.querySelectorAll('#cite-list-area input:checked')).map(cb=>refs.find(r=>String(r.id)===cb.dataset.id)).filter(Boolean)}
  function upd(){const n=getSel().length;el('cite-sc').textContent=`${n}ê°œ ì„ íƒë¨`;el('cite-ins-btn').style.display=n>0?'':'none'}
  function selAll(){document.querySelectorAll('#cite-list-area input[type=checkbox]').forEach(cb=>cb.checked=true);upd()}
  function clrSel(){document.querySelectorAll('#cite-list-area input[type=checkbox]').forEach(cb=>cb.checked=false);upd()}

  function insert(){
    const sel=getSel();if(!sel.length)return;
    const style=el('cite-style').value;const ed=el('editor');const pos=ed.selectionStart;let text='';
    if(style==='inline')text='('+sel.map(r=>r.key).join('; ')+')';
    else if(style==='narrative')text=sel.map(r=>`${r.author}(${r.year})`).join('; ');
    else if(style==='multi')text='('+sel.map(r=>r.key).join('; ')+')';
    else if(style==='footnote'){let it='',dt='\n';sel.forEach((r,i)=>{const n=Math.floor((ed.value.match(/\[\^\d+\]/g)||[]).length/2)+i+1;it+=`[^${n}]`;dt+=`[^${n}]: ${r.full}\n`});ed.value=ed.value.substring(0,pos)+it+ed.value.substring(pos)+dt;App.render();US.snap();App.hideModal('cite-modal');return}
    ed.value=ed.value.substring(0,pos)+text+ed.value.substring(pos);ed.setSelectionRange(pos+text.length,pos+text.length);App.render();US.snap();App.hideModal('cite-modal');
  }

  function renderLib(){
    el('lib-cnt').textContent=refs.length;
    if(!refs.length){el('lib-list').innerHTML='<div class="cite-empty">ì €ì¥ëœ ì°¸ê³ ë¬¸í—Œì´ ì—†ìŠµë‹ˆë‹¤.</div>';return}
    el('lib-list').innerHTML=refs.map((r,i)=>`<div class="lib-item"><span class="lib-key">${r.key}</span><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:11px" title="${r.full}">${r.full}</span><span style="font-size:10px;color:var(--tx3);flex-shrink:0;margin:0 4px">${r.mla?'MLAâœ“':''}</span><button class="btn-ic" style="color:var(--er);font-size:12px;flex-shrink:0" onclick="CM.del(${i})">âœ•</button></div>`).join('');
  }

  function del(i){refs.splice(i,1);save();renderLib();renderList(el('cite-search')?.value||'')}
  function clearAll(){if(!confirm('ëª¨ë“  ì°¸ê³ ë¬¸í—Œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;refs=[];save();renderLib();renderList('')}

  function insertRefSection(){
    const ed=el('editor');const pos=ed.selectionEnd;
    const list=refs.map((r,i)=>`${i+1}. ${r.full}`).join('\n');
    const block=`\n\n<div class="ref-block">\n\n**ì°¸ê³ ë¬¸í—Œ**\n\n${list}\n\n</div>\n`;
    ed.value=ed.value.substring(0,pos)+block+ed.value.substring(pos);App.render();US.snap();App.hideModal('cite-modal');
  }

  function downloadLib(){
    let content=`# ì°¸ê³ ë¬¸í—Œ ëª©ë¡ (${new Date().toLocaleDateString()})\n\n`;
    content+=`## APA 7\n\n`;refs.forEach((r,i)=>{content+=`${i+1}. ${r.full}\n`});
    content+=`\n## MLA 9\n\n`;refs.forEach((r,i)=>{content+=`${i+1}. ${r.mla||toMLA(r)}\n`});
    content+=`\n## Chicago (Author-Date)\n\n`;refs.forEach((r,i)=>{content+=`${i+1}. ${r.chicago||toChicago(r)}\n`});
    dlBlob(content,'references.txt','text/plain;charset=utf-8');
  }

  function tab(name){
    const names=['add','cite','convert','lib'];
    names.forEach((n,i)=>{document.querySelectorAll('.tab')[i].classList.toggle('active',n===name);el(`cp-${n}`).classList.toggle('active',n===name)});
    if(name==='cite'){renderList(el('cite-search')?.value||'');el('cite-ins-btn').style.display='none'}
    if(name==='lib')renderLib();
  }

  function open(){load();renderList('');renderLib();el('cite-ins-btn').style.display='none'}

  return{load,setSep,parse,loadFile,filter,toggle,getSel,upd,selAll,clrSel,insert,del,clearAll,insertRefSection,downloadLib,convertStyle,copyConverted,insertConverted,tab,open};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CAPTION MANAGER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CAP=(()=>{
  let type='table';let selOpt=0;

  const tableOpts=[
    {label:'&lt;í‘œ N&gt;',template:(n,d)=>`<í‘œ${n}> ${d}`},
    {label:'í‘œ N.',template:(n,d)=>`í‘œ ${n}. ${d}`},
    {label:'&lt;Table N&gt;',template:(n,d)=>`<Table ${n}> ${d}`},
    {label:'Table N.',template:(n,d)=>`Table ${n}. ${d}`},
  ];
  const figOpts=[
    {label:'[ê·¸ë¦¼ N]',template:(n,d)=>`[ê·¸ë¦¼ ${n}] ${d}`},
    {label:'ê·¸ë¦¼ N.',template:(n,d)=>`ê·¸ë¦¼ ${n}. ${d}`},
    {label:'[Fig N]',template:(n,d)=>`[Fig ${n}] ${d}`},
    {label:'Fig N.',template:(n,d)=>`Fig ${n}. ${d}`},
    {label:'[Figure N]',template:(n,d)=>`[Figure ${n}] ${d}`},
    {label:'Figure N.',template:(n,d)=>`Figure ${n}. ${d}`},
  ];

  function show(t){
    type=t;selOpt=0;
    el('cap-title').textContent=t==='table'?'í‘œ ìº¡ì…˜ ì‚½ì…':'ê·¸ë¦¼ ìº¡ì…˜ ì‚½ì…';
    const opts=t==='table'?tableOpts:figOpts;
    el('cap-opts').innerHTML=opts.map((o,i)=>`<span class="cap-opt${i===0?' sel':''}" onclick="CAP.selOpt(${i})">${o.label}</span>`).join('');
    el('cap-num').value='1';el('cap-desc').value='';
    updatePreview();
    el('caption-modal').classList.add('vis');
  }

  function selOptFn(i){
    selOpt=i;
    document.querySelectorAll('#cap-opts .cap-opt').forEach((o,j)=>o.classList.toggle('sel',j===i));
    updatePreview();
  }

  function updatePreview(){
    const opts=type==='table'?tableOpts:figOpts;
    const n=el('cap-num').value||'1';
    const d=el('cap-desc').value||'(ìº¡ì…˜ ë‚´ìš©)';
    el('cap-preview').textContent=opts[selOpt].template(n,d);
  }

  function insert(){
    const opts=type==='table'?tableOpts:figOpts;
    const n=el('cap-num').value||'1';
    const d=el('cap-desc').value||'ë‚´ìš©';
    const caption=opts[selOpt].template(n,d);
    const ed=el('editor');const pos=ed.selectionEnd;
    const cssClass=type==='table'?'tbl-caption':'fig-caption';
    const md=`\n<span class="${cssClass}">${caption}</span>\n`;
    ins(ed,pos,pos,md);
    App.hideModal('caption-modal');
  }

  return{show,selOpt:selOptFn,updatePreview,insert};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAPER TEMPLATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TMPLS=[
  {name:'í•™ìœ„ë…¼ë¬¸ (ì‚¬íšŒê³¼í•™Â·êµìœ¡í•™Â·ì‹¬ë¦¬í•™)',icon:'ğŸ“',desc:'êµ­ë¬¸ì´ˆë¡, Abstract, 6ì¥ êµ¬ì¡°',content:`# ë…¼ë¬¸ ì œëª©

---

## êµ­ë¬¸ì´ˆë¡

í•µì‹¬ì–´: 

---

## Abstract

Keywords: 

---

## ëª©ì°¨

---

## í‘œ ëª©ì°¨

---

## ê·¸ë¦¼ ëª©ì°¨

---

# ì œ1ì¥ ì„œë¡ 

## 1. ì—°êµ¬ì˜ í•„ìš”ì„±

## 2. ì—°êµ¬ ëª©ì 

## 3. ì—°êµ¬ ë¬¸ì œ

1. 
2. 

## 4. ì—°êµ¬ ê°€ì„¤

## 5. ìš©ì–´ì˜ ì •ì˜

## 6. ì—°êµ¬ì˜ ì œí•œì 

<div class="page-break"></div>

# ì œ2ì¥ ì´ë¡ ì  ë°°ê²½

## 1. í•µì‹¬ ì´ë¡ 

## 2. ì„ í–‰ì—°êµ¬ ê³ ì°°

## 3. ì—°êµ¬ëª¨í˜• ì„¤ì •

<div class="page-break"></div>

# ì œ3ì¥ ì—°êµ¬ë°©ë²•

## 1. ì—°êµ¬ëŒ€ìƒ

## 2. ì—°êµ¬ë„êµ¬

## 3. ìë£Œìˆ˜ì§‘ ì ˆì°¨

## 4. ë¶„ì„ë°©ë²•

## 5. ì—°êµ¬ëª¨í˜• ë¶„ì„ì „ëµ

<div class="page-break"></div>

# ì œ4ì¥ ì—°êµ¬ê²°ê³¼

## 1. ê¸°ìˆ í†µê³„

## 2. ì¸¡ì •ëª¨í˜• ê²€ì¦

## 3. êµ¬ì¡°ëª¨í˜• ë¶„ì„

## 4. ì¶”ê°€ ë¶„ì„

<div class="page-break"></div>

# ì œ5ì¥ ë…¼ì˜

## 1. ê²°ê³¼ í•´ì„

## 2. ì´ë¡ ì  ì‹œì‚¬ì 

## 3. ì‹¤ì²œì  ì‹œì‚¬ì 

<div class="page-break"></div>

# ì œ6ì¥ ê²°ë¡ 

## 1. ì—°êµ¬ ìš”ì•½

## 2. ì •ì±…ì  ì œì–¸

## 3. í›„ì†ì—°êµ¬ ì œì•ˆ

<div class="page-break"></div>

# ì°¸ê³ ë¬¸í—Œ

<div class="ref-block">

</div>

---

# ë¶€ë¡
`},
  {name:'SSCI / KCI í•™ìˆ ì§€',icon:'ğŸ“°',desc:'êµ­ì œí•™ìˆ ì§€ í‘œì¤€ IMRaD êµ¬ì¡°',content:`# ë…¼ë¬¸ ì œëª©

**Authors:** 

**Journal:** 

**Received:** | **Accepted:** | **Published:** 

---

## Abstract

**Keywords:** 

---

# 1. Introduction

## 1.1 Background

## 1.2 Research Gap

## 1.3 Research Purpose

<div class="page-break"></div>

# 2. Literature Review

<div class="page-break"></div>

# 3. Theoretical Framework and Hypotheses

**H1:** 

**H2:** 

<div class="page-break"></div>

# 4. Method

## 4.1 Participants

## 4.2 Measures

## 4.3 Procedure

## 4.4 Data Analysis

<div class="page-break"></div>

# 5. Results

<div class="page-break"></div>

# 6. Discussion

## 6.1 Theoretical Implications

## 6.2 Practical Implications

## 6.3 Limitations and Future Research

<div class="page-break"></div>

# 7. Conclusion

<div class="page-break"></div>

# References

<div class="ref-block">

</div>
`},
  {name:'ë‹¨ì¼ ì—°êµ¬ ë…¼ë¬¸ (ì‹¤ì¦)',icon:'ğŸ”¬',desc:'ì„œë¡ -ë°©ë²•-ê²°ê³¼-ë…¼ì˜ 4ë‹¨ êµ¬ì¡°',content:`# ë…¼ë¬¸ ì œëª©

**ì €ì:** 

---

## ìš”ì•½

**ì£¼ìš”ì–´:** 

---

# 1. ì„œë¡ 

<div class="page-break"></div>

# 2. ì´ë¡ ì  ë°°ê²½ ë° ê°€ì„¤ ì„¤ì •

## 2.1 ì´ë¡ ì  ë°°ê²½

## 2.2 ì—°êµ¬ ê°€ì„¤

**ê°€ì„¤ 1:** 

**ê°€ì„¤ 2:** 

<div class="page-break"></div>

# 3. ì—°êµ¬ë°©ë²•

## 3.1 ì—°êµ¬ëŒ€ìƒ

## 3.2 ì¸¡ì •ë„êµ¬

## 3.3 ë¶„ì„ë°©ë²•

<div class="page-break"></div>

# 4. ì—°êµ¬ê²°ê³¼

## 4.1 ê¸°ìˆ í†µê³„

## 4.2 ê°€ì„¤ ê²€ì¦

<div class="page-break"></div>

# 5. ë…¼ì˜ ë° ê²°ë¡ 

## 5.1 ë…¼ì˜

## 5.2 ê²°ë¡ 

## 5.3 ì—°êµ¬ì˜ í•œê³„

# ì°¸ê³ ë¬¸í—Œ

<div class="ref-block">

</div>
`},
  {name:'ë‹¤ì¤‘ ì—°êµ¬ (Study 1 / Study 2)',icon:'ğŸ“Š',desc:'ë³µìˆ˜ ì—°êµ¬ í¬í•¨ ì‹¤ì¦ ë…¼ë¬¸ êµ¬ì¡°',content:`# ë…¼ë¬¸ ì œëª©

**Authors:** 

---

## Abstract

**Keywords:** 

---

# 1. Introduction

<div class="page-break"></div>

# 2. Study 1

## 2.1 Method

### 2.1.1 Participants

### 2.1.2 Measures

### 2.1.3 Procedure

## 2.2 Results

## 2.3 Discussion

<div class="page-break"></div>

# 3. Study 2

## 3.1 Method

### 3.1.1 Participants

### 3.1.2 Measures

### 3.1.3 Procedure

## 3.2 Results

## 3.3 Discussion

<div class="page-break"></div>

# 4. General Discussion

## 4.1 Theoretical Contributions

## 4.2 Practical Implications

## 4.3 Limitations and Future Research

# References

<div class="ref-block">

</div>
`},
  {name:'ë©”íƒ€ë¶„ì„ ë…¼ë¬¸',icon:'ğŸ“ˆ',desc:'ì²´ê³„ì  ë¬¸í—Œ ê²€í†  ë° ë©”íƒ€ë¶„ì„',content:`# ë…¼ë¬¸ ì œëª©: A Meta-Analysis

**Authors:** 

---

## Abstract

**Keywords:** 

---

# 1. Introduction

## 1.1 Theoretical Background

## 1.2 Purpose of Meta-Analysis

<div class="page-break"></div>

# 2. Literature Search Strategy

## 2.1 Search Databases

## 2.2 Search Keywords

## 2.3 Search Period

<div class="page-break"></div>

# 3. Inclusion Criteria

## 3.1 Inclusion Criteria

## 3.2 Exclusion Criteria

## 3.3 PRISMA Flow Diagram

<div class="page-break"></div>

# 4. Coding Procedure

## 4.1 Variables Coded

## 4.2 Coder Agreement

<div class="page-break"></div>

# 5. Statistical Analysis

## 5.1 Effect Size Calculation

## 5.2 Heterogeneity Test

## 5.3 Moderator Analysis

<div class="page-break"></div>

# 6. Results

## 6.1 Overall Effect Size

## 6.2 Moderator Effects

<div class="page-break"></div>

# 7. Publication Bias Test

## 7.1 Funnel Plot

## 7.2 Egger's Test

<div class="page-break"></div>

# 8. Discussion

## 8.1 Interpretation of Effect Sizes

## 8.2 Practical Implications

## 8.3 Limitations

# References

<div class="ref-block">

</div>

---

# Appendix

## Appendix A: List of Included Studies
`},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COLOR PICKER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ColorPicker=(()=>{
  let mode='text';// text | bg
  const TEXT_COLORS=['#e8e8f0','#ff4444','#ff8800','#ffcc00','#44cc44','#00aaff','#aa44ff','#ff44aa','#000000','#333333','#666666','#999999','#cccccc','#ffffff','#5b4ce4','#f7a06a'];
  const BG_COLORS=['#fff176','#ffcc80','#ef9a9a','#80cbc4','#a5d6a7','#90caf9','#ce93d8','#f48fb1','#ffecb3','#dcedc8','transparent'];

  function open(m){
    mode=m;
    el('color-modal-title').textContent=m==='text'?'ê¸€ì ìƒ‰ìƒ ì„¤ì •':'í˜•ê´‘íœ í•˜ì´ë¼ì´íŠ¸ ìƒ‰ìƒ';
    const colors=m==='text'?TEXT_COLORS:BG_COLORS;
    el('color-swatches').innerHTML=colors.map(c=>`<div class="csw" style="background:${c==='transparent'?'repeating-linear-gradient(45deg,#888,#888 2px,transparent 2px,transparent 6px)':c};border-color:${c==='#ffffff'?'#ccc':'transparent'}" onclick="ColorPicker.setHex('${c}')" title="${c}"></div>`).join('');
    el('color-hex').value='';el('color-modal').classList.add('vis');
    updatePreview('');
  }

  function setHex(c){el('color-hex').value=c;updatePreview(c)}

  function updatePreview(c){
    const prev=el('color-preview');
    if(mode==='text'){prev.style.color=c||'inherit';prev.style.background=''}
    else{prev.style.background=c==='transparent'?'':c;prev.style.color=''}
  }

  function apply(){
    const c=el('color-hex').value.trim();if(!c)return;
    const ed=el('editor');const s=ed.selectionStart,e=ed.selectionEnd;const sel=ed.value.substring(s,e)||'í…ìŠ¤íŠ¸';
    let wrapped;
    if(mode==='text'){wrapped=`<span style="color:${c}">${sel}</span>`}
    else{wrapped=c==='transparent'?sel:`<span style="background:${c}">${sel}</span>`}
    ins(ed,s,e,wrapped);
    // update toolbar bar
    if(mode==='text'){el('fc-bar').style.background=c}
    else{el('hl-bar').style.background=c}
    App.hideModal('color-modal');
  }

  return{open,setHex,updatePreview,apply};
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDITOR ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   IMAGE DROP HANDLER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const IMG=(()=>{
  function dragOver(e){e.preventDefault();e.stopPropagation();el('img-dropzone').style.borderColor='var(--ac)';el('img-dropzone').style.background='var(--acg)'}
  function dragLeave(e){el('img-dropzone').style.borderColor='var(--bd)';el('img-dropzone').style.background='var(--bg3)'}
  function drop(e){
    e.preventDefault();e.stopPropagation();
    dragLeave(e);
    const file=e.dataTransfer.files[0];
    if(file&&file.type.startsWith('image/'))loadImage(file);
  }
  function fileSelected(ev){
    const file=ev.target.files[0];
    if(file)loadImage(file);
    ev.target.value='';
  }
  function loadImage(file){
    const reader=new FileReader();
    reader.onload=ev=>{
      const dataUrl=ev.target.result;
      el('img-url').value=dataUrl;
      if(!el('img-alt').value)el('img-alt').value=file.name.replace(/\.[^.]+$/,'');
      // Show preview
      el('img-preview').src=dataUrl;
      el('img-preview-wrap').style.display='block';
      el('img-drop-text').textContent='âœ“ '+file.name+' ('+Math.round(file.size/1024)+'KB)';
      el('img-drop-text').style.color='var(--ok)';
    };
    reader.readAsDataURL(file);
  }
  return{dragOver,dragLeave,drop,fileSelected};
})();

let lastCodeLang='python';// track last used language for Alt+C

const ED={
  ed(){return el('editor')},
  h(lv){const ed=this.ed();repCL(ed,'#'.repeat(lv)+' '+getCL(ed).text.replace(/^#+\s*/,''))},
  bold(){
    const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd,sel=ed.value.substring(s,e);
    if(!sel){ins(ed,s,e,'**í…ìŠ¤íŠ¸**');ed.setSelectionRange(s+2,s+5);return}
    const b2=ed.value.substring(s-2,s),a2=ed.value.substring(e,e+2);
    if(b2==='**'&&a2==='**'){ed.value=ed.value.substring(0,s-2)+sel+ed.value.substring(e+2);ed.setSelectionRange(s-2,e-2);App.render();US.snap();return}
    const b3=ed.value.substring(s-3,s),a4=ed.value.substring(e,e+4);
    if(b3==='<b>'&&a4==='</b>'){ed.value=ed.value.substring(0,s-3)+sel+ed.value.substring(e+4);ed.setSelectionRange(s-3,e-3);App.render();US.snap();return}
    const w=/[()[\]{}<>]/.test(sel)?`<b>${sel}</b>`:`**${sel}**`;
    ins(ed,s,e,w);ed.setSelectionRange(s,s+w.length);
  },
  italic(){const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd,sel=ed.value.substring(s,e)||'í…ìŠ¤íŠ¸';const b=ed.value.substring(s-1,s),a=ed.value.substring(e,e+1);if(b==='*'&&a==='*'){ed.value=ed.value.substring(0,s-1)+sel+ed.value.substring(e+1);ed.setSelectionRange(s-1,s-1+sel.length);App.render()}else ins(ed,s,e,`*${sel}*`)},
  strike(){const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd;ins(ed,s,e,`~~${ed.value.substring(s,e)||'í…ìŠ¤íŠ¸'}~~`)},
  inlineCode(){const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd;ins(ed,s,e,`\`${ed.value.substring(s,e)||'code'}\``)},
  fontSize(size){if(!size)return;const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd,sel=ed.value.substring(s,e)||'í…ìŠ¤íŠ¸';ins(ed,s,e,`<span style="font-size:${size}">${sel}</span>`);el('fsize-sel').value=''},
  align(dir){const ed=this.ed();const{text}=getCL(ed);const c=text.replace(/<div[^>]*>(.*?)<\/div>/gi,'$1');repCL(ed,dir==='left'?c:`<div style="text-align:${dir}">${c}</div>`)},
  list(type){const ed=this.ed(),s=ed.selectionStart;const p=type==='ul'?'- ':'1. ';ins(ed,s,s,`\n${p}í•­ëª© 1\n${p}í•­ëª© 2\n${p}í•­ëª© 3\n`)},
  bquote(){const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd,sel=ed.value.substring(s,e);if(sel)ins(ed,s,e,sel.split('\n').map(l=>'> '+l).join('\n'));else ins(ed,s,s,'\n> ì¸ìš©ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”\n')},
  table(){const ed=this.ed(),s=ed.selectionStart;ins(ed,s,s,'\n| í—¤ë” 1 | í—¤ë” 2 | í—¤ë” 3 |\n| :-- | :-- | :-- |\n| ì…€ | ì…€ | ì…€ |\n| ì…€ | ì…€ | ì…€ |\n')},
  tableRow(){const ed=this.ed(),val=ed.value,pos=ed.selectionStart;const le=val.indexOf('\n',pos),ln=val.substring(val.lastIndexOf('\n',pos-1)+1,le===-1?val.length:le);if(!ln.trim().startsWith('|')){this.table();return}const cols=ln.split('|').filter(c=>c.trim()!=='').length;ins(ed,le===-1?val.length:le,le===-1?val.length:le,'\n|'+' ì…€ |'.repeat(cols))},
  tableCol(){const ed=this.ed(),lines=ed.value.split('\n');const cur=ed.value.substring(0,ed.selectionStart).split('\n').length-1;if(!lines[cur].trim().startsWith('|')){this.table();return}let s=cur,e2=cur;while(s>0&&lines[s-1].trim().startsWith('|'))s--;while(e2<lines.length-1&&lines[e2+1].trim().startsWith('|'))e2++;ed.value=lines.map((l,i)=>{if(i<s||i>e2||!l.trim().startsWith('|'))return l;return /^\|[\s:|-]+\|$/.test(l.trim())?l.trimEnd()+' :-- |':l.trimEnd()+' ìƒˆì—´ |'}).join('\n');App.render();US.snap()},
  // Direct code block with last used language (for Alt+C hotkey)
  codeBlockDirect(){const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd;const sel=ed.value.substring(s,e)||'// ì½”ë“œ ì…ë ¥';ins(ed,s,e,`\n\`\`\`${lastCodeLang}\n${sel}\n\`\`\`\n`)},
  // Code block from modal (toolbar âŒ¨ button)
  codeBlockModal(){const lang=el('code-lang').value;lastCodeLang=lang||lastCodeLang;const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd;const sel=ed.value.substring(s,e)||'// ì½”ë“œ ì…ë ¥';ins(ed,s,e,`\n\`\`\`${lastCodeLang}\n${sel}\n\`\`\`\n`);App.hideModal('code-modal')},
  pageBreak(){const ed=this.ed(),s=ed.selectionStart;ins(ed,s,s,'\n\n<div class="page-break"></div>\n\n')},
  lineBreak(){const ed=this.ed(),s=ed.selectionStart;ins(ed,s,s,'<br>\n')},
  link(){const text=el('link-text').value||'ë§í¬';const url=el('link-url').value||'#';const ed=this.ed(),s=ed.selectionStart;ins(ed,s,s,`[${text}](${url})`);App.hideModal('link-modal');el('link-text').value='';el('link-url').value=''},
  image(){const alt=el('img-alt').value||'ì´ë¯¸ì§€';const url=el('img-url').value||'#';const ed=this.ed(),s=ed.selectionStart;ins(ed,s,s,`![${alt}](${url})`);el('img-alt').value='';el('img-url').value='';App.hideModal('image-modal')},
  math(){const ed=this.ed(),s=ed.selectionStart,e=ed.selectionEnd,sel=ed.value.substring(s,e);ins(ed,s,e,sel?`$$\n${sel}\n$$`:'\n$$\n\\phi = \\frac{\\lambda_2}{c^2}\n$$\n')},
  footnote(){const ed=this.ed(),s=ed.selectionStart;const n=Math.floor((ed.value.match(/\[\^\d+\]/g)||[]).length/2)+1;ins(ed,s,s,`[^${n}]`);ed.value+=`\n[^${n}]: ê°ì£¼ ë‚´ìš©.`;App.render();US.snap()},
  dupLine(){const ed=this.ed();const{le,text}=getCL(ed);ins(ed,le,le,'\n'+text)},
  tabInTable(ed,ev){const val=ed.value,pos=ed.selectionStart;const ls=val.lastIndexOf('\n',pos-1)+1,le=val.indexOf('\n',pos);const ln=val.substring(ls,le===-1?val.length:le);if(!ln.trim().startsWith('|'))return false;ev.preventDefault();const pipes=[];for(let i=ls;i<(le===-1?val.length:le);i++)if(val[i]==='|')pipes.push(i);const nx=pipes.find(p=>p>pos),nn=nx!==undefined?pipes.find(p=>p>nx):undefined;if(nx!==undefined&&nn!==undefined)ed.setSelectionRange(nx+1,nn);return true},
  enterInTable(ed,ev){const val=ed.value,pos=ed.selectionStart;const ls=val.lastIndexOf('\n',pos-1)+1,le=val.indexOf('\n',pos);const ln=val.substring(ls,le===-1?val.length:le);if(!ln.trim().startsWith('|')||/^\|[\s:|-]+\|$/.test(ln.trim()))return false;ev.preventDefault();const cols=ln.split('|').filter(c=>c.trim()!=='').length;ins(ed,le===-1?val.length:le,le===-1?val.length:le,'\n|'+' ì…€ |'.repeat(cols));return true},
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOTKEY ENGINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function hkKey(e){const mac=navigator.platform.toUpperCase().includes('MAC');const ctrl=mac?e.metaKey:e.ctrlKey;const parts=[];if(ctrl)parts.push('C');if(e.shiftKey)parts.push('S');if(e.altKey)parts.push('A');parts.push(e.key.length===1?e.key.toUpperCase():e.key);return parts.join('+')}

function handleKey(e){
  const edi=el('editor');const inEd=document.activeElement===edi;const k=hkKey(e);
  if(!inEd){if(k==='S+?'){e.preventDefault();App.showHK()}return}
  if(k==='C+Z'){e.preventDefault();US.undo();return}
  if(k==='C+S+Z'||k==='C+Y'){e.preventDefault();US.redo();return}
  if(e.key==='Tab'){if(ED.tabInTable(edi,e))return}
  if(e.key==='Enter'&&!e.shiftKey&&!e.ctrlKey&&!e.altKey){if(ED.enterInTable(edi,e))return}
  const map={
    'C+B':()=>ED.bold(),'C+I':()=>ED.italic(),'C+.':()=>ED.bquote(),
    'C+Enter':()=>ED.pageBreak(),'C+S+Enter':()=>ED.lineBreak(),
    'C+A+1':()=>ED.h(1),'C+A+2':()=>ED.h(2),'C+A+3':()=>ED.h(3),
    'S+A+L':()=>ED.align('left'),'S+A+C':()=>ED.align('center'),'S+A+R':()=>ED.align('right'),
    'A+8':()=>ED.table(),'A+9':()=>ED.tableRow(),'A+0':()=>ED.tableCol(),
    'A+C':()=>ED.codeBlockDirect(),// direct code block with last lang
    'A+V':()=>ED.inlineCode(),// inline `code`
    'S+A+ArrowDown':()=>ED.dupLine(),
    'C+S':()=>App.showSaveDlg(),'C+F':()=>App.toggleFind(),
    'C+S+P':()=>PW.open(),'C+S+R':()=>App.toggleRM(),'C+S+C':()=>App.showCite(),
    'S+?':()=>App.showHK(),
  };
  if(map[k]){e.preventDefault();map[k]()}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOOLTIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initTooltip(){
  const tip=el('tooltip');let t;
  document.addEventListener('mouseover',e=>{const target=e.target.closest('[data-tooltip]');if(!target)return;clearTimeout(t);t=setTimeout(()=>{const key=target.dataset.key;tip.innerHTML=target.dataset.tooltip+(key?` <span class="tt-key">${key}</span>`:'');tip.classList.add('vis');let x=e.clientX+12,y=e.clientY+16;if(x+260>window.innerWidth)x=e.clientX-260;if(y+40>window.innerHeight)y=e.clientY-40;tip.style.left=x+'px';tip.style.top=y+'px'},300)});
  document.addEventListener('mouseout',()=>{clearTimeout(t);tip.classList.remove('vis')});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ERROR DETECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function detectErrors(md){
  const errs=[];const lines=md.split('\n');
  lines.forEach((l,i)=>{if(l.startsWith('|')){const cols=l.split('|').filter(c=>c.trim()!=='').length;if(i>0&&lines[i-1].startsWith('|')){const p=lines[i-1].split('|').filter(c=>c.trim()!=='').length;if(p!==cols&&!l.includes('---')&&!lines[i-1].includes('---'))errs.push(`ì¤„ ${i+1}: í‘œ ì—´ ë¶ˆì¼ì¹˜ (ì´ì „ ${p}, í˜„ì¬ ${cols})`)}}});
  if((md.match(/^```/gm)||[]).length%2!==0)errs.push('ì½”ë“œ ë¸”ë¡ ë¯¸ë‹«í˜ (``` ëˆ„ë½)');
  return errs;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const App={
  rm:false,rt:null,colorMode:'text',capType:'table',

  init(){
    AS.load();CM.load();initTooltip();SS.init();
    const edi=el('editor');
    edi.addEventListener('input',()=>{US.snap();this.render()});
    edi.addEventListener('keydown',handleKey);
    edi.addEventListener('keyup',()=>this.updCursor());
    edi.addEventListener('click',()=>this.updCursor());
    edi.addEventListener('scroll',()=>LN.update(),{passive:true});
    document.addEventListener('selectionchange',()=>{if(document.activeElement===edi)this.updFmtBtns()});
    document.addEventListener('keydown',e=>{if(document.activeElement!==edi)handleKey(e)});
    el('doc-title').addEventListener('input',()=>this.render());
    setInterval(()=>PW.checkClosed(),2000);

    // Build template grid
    el('tmpl-grid').innerHTML=TMPLS.map((t,i)=>`<div class="tmpl-card" onclick="App.insertTmpl(${i})"><h4>${t.icon} ${t.name}</h4><p>${t.desc}</p></div>`).join('');

    if(!edi.value)edi.value=this.sample();
    this.render();US.snap();
  },

  render(){
    const edi=el('editor');const md=edi.value,title=el('doc-title').value;
    clearTimeout(this.rt);
    this.rt=setTimeout(()=>{
      PR.render(md);TOC.build(md);
      const errs=detectErrors(md);this.showErrs(errs);
      const words=md.trim()?md.trim().split(/\s+/).length:0;
      el('sw').textContent=words.toLocaleString()+' ë‹¨ì–´';
      el('sc').textContent=md.length.toLocaleString()+' ì';
      el('sp').textContent='ì•½ '+Math.ceil(words/250)+' í˜ì´ì§€';
      LN.update();
      el('render-ts').textContent=new Date().toLocaleTimeString();
      AS.save(md,title);
      PW.sync();
    },120);
    this.updCursor();
  },

  updCursor(){const edi=el('editor');const t=edi.value.substring(0,edi.selectionStart),ls=t.split('\n');el('cursor-pos').textContent=`ì¤„ ${ls.length}, ì—´ ${ls[ls.length-1].length+1}`;const sl=edi.selectionEnd-edi.selectionStart;el('sel-info').textContent=sl>0?`${sl}ì ì„ íƒ`:''},
  updFmtBtns(){const edi=el('editor'),s=edi.selectionStart,e=edi.selectionEnd;const b2=edi.value.substring(s-2,s),a2=edi.value.substring(e,e+2);const b3=edi.value.substring(s-3,s),a4=edi.value.substring(e,e+4);el('bold-btn').classList.toggle('active',(b2==='**'&&a2==='**')||(b3==='<b>'&&a4==='</b>'));const b1=edi.value.substring(s-1,s),a1=edi.value.substring(e,e+1);el('italic-btn').classList.toggle('active',b1==='*'&&a1==='*')},
  showErrs(errs){const ec=el('error-count'),sep=el('ec-sep'),list=el('ep-list'),panel=el('error-panel');if(!errs.length){ec.textContent='';sep.style.display='none';panel.classList.remove('vis');return}ec.textContent=`âš  ${errs.length}ê°œ ì˜¤ë¥˜`;sep.style.display='block';list.innerHTML=errs.map(e=>`<div class="error-item">${e}</div>`).join('')},
  toggleErr(){el('error-panel').classList.toggle('vis')},closeErr(){el('error-panel').classList.remove('vis')},
  toggleSidebar(){el('app').classList.toggle('ns')},
  setView(m){el('editor-pane').classList.toggle('hidden',m==='preview');el('preview-pane').classList.toggle('hidden',m==='editor')},
  toggleTheme(){document.documentElement.dataset.theme=document.documentElement.dataset.theme==='light'?'':'light'},
  toggleRM(){this.rm=!this.rm;el('rm-badge').classList.toggle('vis',this.rm);el('mode-ind').textContent=this.rm?'RESEARCH':'NORMAL';PR.rm=this.rm;PW.setRM(this.rm);this.render()},
  showHK(){el('hk-overlay').classList.add('vis')},hideHK(){el('hk-overlay').classList.remove('vis')},
  showCode(){el('code-modal').classList.add('vis')},
  showLink(){el('link-modal').classList.add('vis');setTimeout(()=>el('link-text').focus(),50)},
  showImg(){
    // reset drop zone
    el('img-drop-text').textContent='ğŸ–¼ ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì„ íƒ';
    el('img-drop-text').style.color='';
    el('img-preview-wrap').style.display='none';
    el('img-dropzone').style.borderColor='';el('img-dropzone').style.background='';
    el('image-modal').classList.add('vis');setTimeout(()=>el('img-alt').focus(),50);
  },
  showCite(){CM.open();el('cite-modal').classList.add('vis')},
  showSaveDlg(){el('save-modal').classList.add('vis')},
  hideModal(id){el(id).classList.remove('vis')},
  openColorPicker(m){ColorPicker.open(m)},
  applyColor(){ColorPicker.apply()},
  showCaption(type){CAP.show(type)},
  updateCapPreview(){CAP.updatePreview()},
  insertCaption(){CAP.insert()},
  showTmpl(){el('tmpl-modal').classList.add('vis')},
  insertTmpl(i){
    const t=TMPLS[i];
    if(!confirm(`"${t.name}" ì–‘ì‹ì„ í˜„ì¬ ë¬¸ì„œì— ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`))return;
    const edi=el('editor');edi.value=(edi.value.trim()?edi.value+'\n\n---\n\n':'')+t.content;
    this.render();US.snap();App.hideModal('tmpl-modal');
  },

  toggleFind(){const bar=el('find-bar');bar.classList.toggle('vis');if(bar.classList.contains('vis'))el('fi').focus()},
  findKey(e){if(e.key==='Enter')this.findNext();if(e.key==='Escape')this.toggleFind()},
  findNext(){const q=el('fi').value;if(!q)return;const edi=el('editor');const idx=edi.value.indexOf(q,edi.selectionEnd);const fi2=idx===-1?edi.value.indexOf(q):idx;if(fi2!==-1){edi.setSelectionRange(fi2,fi2+q.length);edi.focus()}const cnt=(edi.value.match(new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'))||[]).length;el('fc-cnt').textContent=cnt?`${cnt}ê±´`:q?'ì—†ìŒ':''},
  replaceOne(){const q=el('fi').value,r=el('ri').value;if(!q)return;const edi=el('editor'),s=edi.selectionStart,e=edi.selectionEnd;if(edi.value.substring(s,e)===q){edi.value=edi.value.substring(0,s)+r+edi.value.substring(e);this.render()}else this.findNext()},
  replaceAll(){const q=el('fi').value,r=el('ri').value;if(!q)return;const edi=el('editor');const cnt=(edi.value.match(new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'))||[]).length;edi.value=edi.value.replaceAll(q,r);this.render();US.snap();el('fc-cnt').textContent=`${cnt}ê±´ êµì²´ë¨`},

  saveMD(){const c=el('editor').value,t=el('doc-title').value.replace(/[^a-z0-9ê°€-í£]/gi,'_');dlBlob(c,`${t}.md`,'text/markdown');this.hideModal('save-modal')},
  saveTXT(){const c=el('editor').value.replace(/[#*_`~>|]/g,'').replace(/\[(.*?)\]\(.*?\)/g,'$1').replace(/<[^>]+>/g,'');dlBlob(c,(el('doc-title').value||'document').replace(/[^a-z0-9ê°€-í£]/gi,'_')+'.txt','text/plain;charset=utf-8');this.hideModal('save-modal')},
  saveHTML(){
    const md=el('editor').value;const title=el('doc-title').value;
    const showFn=el('show-footnotes-chk').checked;
    const pages=splitPages(md);
    const html=pages.map((p,i)=>`<div class="preview-page${this.rm?' rm':''}" data-page="${i+1}">${mdRender(p,showFn)}</div>`).join('');
    const CSS=`body{font-family:sans-serif;background:#6a6e7e;display:flex;flex-direction:column;align-items:center;padding:20px 0 40px}.preview-page{width:210mm;min-height:297mm;background:white;color:#1a1a2e;padding:22mm 18mm;box-shadow:0 4px 30px rgba(0,0,0,.4);font-family:'Libre Baskerville',Georgia,serif;font-size:11pt;line-height:1.8;word-break:break-word;position:relative;margin-bottom:20px}.preview-page::after{content:"â€” " attr(data-page) " â€”";position:absolute;bottom:10mm;left:50%;transform:translateX(-50%);font-family:sans-serif;font-size:9pt;color:#bbb}.preview-page h1{font-size:21pt;font-weight:700;margin:0 0 14px;border-bottom:2px solid #1a1a2e;padding-bottom:8px}.preview-page h2{font-size:15pt;margin:20px 0 10px;font-weight:700}.preview-page h3{font-size:12pt;margin:16px 0 7px;font-weight:700}.preview-page p{margin:0 0 11px}.preview-page ul,.preview-page ol{margin:0 0 11px;padding-left:22px}.preview-page table{width:100%;border-collapse:collapse;margin:11px 0;font-size:10pt}.preview-page th{background:#1a1a2e;color:#fff;padding:7px 11px;text-align:left}.preview-page td{padding:6px 11px;border:1px solid #d0d0e0}.preview-page tr:nth-child(even) td{background:#f7f7fc}.preview-page code{font-family:monospace;font-size:9pt;background:#f0f0f8;padding:1px 4px;border-radius:3px;color:#5b4ce4}.preview-page pre{background:#1a1a2e;color:#e8e8f0;padding:14px;border-radius:6px;margin:11px 0;font-size:9pt}.preview-page pre code{background:none;color:inherit}.preview-page a{color:#5b4ce4}.preview-page img{max-width:100%}.preview-page .footnote-highlight{background:#f0f0f0;color:#1a1a2e;border-radius:2px;padding:0 2px}.preview-page .footnote-def{background:#f5f5f5;color:#1a1a2e;border-left:3px solid #bbb;padding:4px 10px;margin:4px 0;font-size:9.5pt}.preview-page .footnotes-section{border-top:1px solid #d0d0e0;margin-top:24px;padding-top:10px;font-size:9.5pt;color:#444}@media print{body{background:none;padding:0}.preview-page{box-shadow:none;margin:0;page-break-after:always;width:100%;min-height:0}.preview-page:last-child{page-break-after:auto}.preview-page::after{display:none}}`;
    const fullHtml=`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>${title}</title><style>${CSS}</style></head><body>${html}</body></html>`;
    dlBlob(fullHtml,(el('doc-title').value||'document').replace(/[^a-z0-9ê°€-í£]/gi,'_')+'.html','text/html;charset=utf-8');
    this.hideModal('save-modal');
  },
  printDoc(){
    const md=el('editor').value;const title=el('doc-title').value;
    const showFn=document.getElementById('show-footnotes-chk')?el('show-footnotes-chk').checked:true;
    const pages=splitPages(md);
    const html=pages.map((p,i)=>`<div class="preview-page${this.rm?' rm':''}" data-page="${i+1}">${mdRender(p,showFn)}</div>`).join('');
    const CSS=`@import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap');*{box-sizing:border-box;margin:0;padding:0}body{font-family:sans-serif;background:#6a6e7e;display:flex;flex-direction:column;align-items:center;padding:20px 0 40px}.preview-page{width:210mm;min-height:297mm;background:white;color:#1a1a2e;padding:22mm 18mm;box-shadow:0 4px 30px rgba(0,0,0,.4);font-family:'Libre Baskerville',Georgia,serif;font-size:11pt;line-height:1.8;word-break:break-word;position:relative;margin-bottom:20px}.preview-page::after{content:"â€” " attr(data-page) " â€”";position:absolute;bottom:10mm;left:50%;transform:translateX(-50%);font-family:sans-serif;font-size:9pt;color:#bbb}.preview-page h1{font-size:21pt;font-weight:700;margin:0 0 14px;border-bottom:2px solid #1a1a2e;padding-bottom:8px}.preview-page h2{font-size:15pt;margin:20px 0 10px;font-weight:700}.preview-page h3{font-size:12pt;margin:16px 0 7px;font-weight:700}.preview-page p{margin:0 0 11px}.preview-page ul,.preview-page ol{margin:0 0 11px;padding-left:22px}.preview-page table{width:100%;border-collapse:collapse;margin:11px 0;font-size:10pt}.preview-page th{background:#1a1a2e;color:#fff;padding:7px 11px;text-align:left}.preview-page td{padding:6px 11px;border:1px solid #d0d0e0}.preview-page tr:nth-child(even) td{background:#f7f7fc}.preview-page code{font-family:'JetBrains Mono',monospace;font-size:9pt;background:#f0f0f8;padding:1px 4px;border-radius:3px;color:#5b4ce4}.preview-page pre{background:#1a1a2e;color:#e8e8f0;padding:14px;border-radius:6px;margin:11px 0;font-size:9pt}.preview-page pre code{background:none;color:inherit}.preview-page img{max-width:100%}.preview-page a{color:#5b4ce4}.preview-page .footnote-highlight{background:#f0f0f0;color:#1a1a2e;border-radius:2px;padding:0 2px}.preview-page .footnote-def{background:#f5f5f5;color:#1a1a2e;border-left:3px solid #bbb;padding:4px 10px;margin:4px 0;font-size:9.5pt}.preview-page .footnotes-section{border-top:1px solid #d0d0e0;margin-top:24px;padding-top:10px;font-size:9.5pt;color:#444}@media print{body{background:none;padding:0}.preview-page{box-shadow:none;margin:0;page-break-after:always;width:100%;min-height:0}.preview-page:last-child{page-break-after:auto}.preview-page::after{display:none}}`;
    const fullHtml=`<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>${title}</title><style>${CSS}</style></head><body>${html}<script>window.onload=function(){window.print();}<\/script></body></html>`;
    const w=window.open('','_blank','width=900,height=700');
    if(w){w.document.open();w.document.write(fullHtml);w.document.close();}
    else{alert('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—…ì„ í—ˆìš©í•´ ì£¼ì„¸ìš”.');}
    this.hideModal('save-modal');
  },

  sample(){return`# Markdown PDF Editor Pro V7

## ì´ë²ˆ ì—…ë°ì´íŠ¸ ì‹ ê¸°ëŠ¥

ëª¨ë“  ê¸°ëŠ¥ì´ í†µí•©ëœ **ì—°êµ¬Â·ë…¼ë¬¸ ì „ìš© ì—ë””í„°**ì…ë‹ˆë‹¤.

### ì£¼ìš” ê¸°ëŠ¥ ëª©ë¡

| ê¸°ëŠ¥ | ë‹¨ì¶•í‚¤ | ì„¤ëª… |
| :-- | :-- | :-- |
| ì½”ë“œ ë¸”ë¡ (ë§ˆì§€ë§‰ ì–¸ì–´) | **Alt+C** | ë§ˆì§€ë§‰ ì‚¬ìš© ì–¸ì–´ ì¦‰ì‹œ ì‚½ì… |
| ì½”ë“œ ë¸”ë¡ (ì–¸ì–´ ì„ íƒ) | âŒ¨ Code ë²„íŠ¼ | ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ |
| ì¸ìš© ì‚½ì… | **Ctrl+Shift+C** | ì°¸ê³ ë¬¸í—Œ ê´€ë¦¬ì |
| Research Mode | **Ctrl+Shift+R** | ë‹¨ë½ ì¤„ë²ˆí˜¸ í‘œì‹œ |
| ì €ì¥ | **Ctrl+S** | MD / TXT / HTML ì„ íƒ |

---

### Research Mode ì¤„ë²ˆí˜¸

**Ctrl+Shift+R** ë˜ëŠ” ğŸ”¬ Research ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ê° ë‹¨ë½ì— ì¤„ë²ˆí˜¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.

ì´ê²ƒì€ ë‘ ë²ˆì§¸ ë‹¨ë½ì…ë‹ˆë‹¤. ì¤„ë²ˆí˜¸ê°€ ì™¼ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.

ì„¸ ë²ˆì§¸ ë‹¨ë½ì…ë‹ˆë‹¤.

---

### ì°¸ê³ ë¬¸í—Œ ê´€ë¦¬ì

**ğŸ“š References** ë²„íŠ¼ìœ¼ë¡œ APA ì°¸ê³ ë¬¸í—Œì„ ë¶™ì—¬ë„£ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ë¹ˆ ì¤„ êµ¬ë¶„**: ì—¬ëŸ¬ ì°¸ê³ ë¬¸í—Œì„ ë¹ˆ ì¤„ë¡œ êµ¬ë¶„
- **ì—”í„° êµ¬ë¶„**: ê° ì¤„ì´ í•˜ë‚˜ì˜ ì°¸ê³ ë¬¸í—Œ

ìŠ¤íƒ€ì¼ ë³€í™˜: APA â†’ MLA 9 / Chicago / Vancouver ìë™ ë³€í™˜ì„ ì§€ì›í•©ë‹ˆë‹¤.

<div class="page-break"></div>

## 2í˜ì´ì§€ â€” ìº¡ì…˜, ìˆ˜ì‹, ë…¼ë¬¸ ì–‘ì‹

### í‘œ ìº¡ì…˜ ì˜ˆì‹œ

<span class="tbl-caption"><í‘œ1> ì—°êµ¬ëŒ€ìƒ íŠ¹ì„±</span>

| ë³€ìˆ˜ | M | SD | n |
| :-- | :-- | :-- | :-- |
| ì—°ë ¹ | 24.5 | 3.2 | 120 |
| í•™ìŠµì‹œê°„ | 5.3 | 1.8 | 120 |

### ìˆ˜ì‹

$$
\\phi = \\frac{\\lambda_2}{c^2}
$$

### ë…¼ë¬¸ ì–‘ì‹

**ğŸ“‹ ì–‘ì‹** ë²„íŠ¼ì„ ëˆŒëŸ¬ í•™ìœ„ë…¼ë¬¸, SSCI/KCI, ë‹¨ì¼/ë‹¤ì¤‘ ì—°êµ¬, ë©”íƒ€ë¶„ì„ êµ¬ì¡°ë¥¼ ì‚½ì…í•˜ì„¸ìš”.

> \`Shift+?\` â†’ ì „ì²´ ë‹¨ì¶•í‚¤ ëª©ë¡
`}
};

window.addEventListener('DOMContentLoaded',()=>App.init());
</script>
</body>
</html>
